import{c as ts,r as m,j as e,B as d,p as is,L as W,s as as,d as Ne,R as be,t as rs,v as ns,e as ls,g as cs,f as os,S as ds}from"./index-DoHIwt5e.js";import{B as ge}from"./badge-C1zNXNx4.js";import{I as z,P as le,b as S,F as X,V as ee,c as ye,Q as ms,d as Le}from"./index-DXxv6v3I.js";import{D as M,a as G,b as J,c as K,d as us,e as hs,f as Te}from"./dialog-B-4PCAt0.js";import{u as te}from"./use-toast-DbRgK7NN.js";import{u as ie,F as ce,C as T}from"./index.esm-DJd3S9K5.js";import{o as oe,s as V,b as U,t as de,c as ne,e as De,Z as se,n as ve}from"./index-BfIswrMu.js";import{F as Fe,a as I,b as P,c as $,d as R,e as _,M as me}from"./markdown-form-field-Cwd5yOXl.js";import{S as q,A as ze,a as Ae,b as Ee,c as ke,d as Se,e as Ie,f as Pe,g as $e,h as Re}from"./alert-dialog-WSqYsHid.js";import{a as A}from"./axios-BzDuykoy.js";import{a as ps}from"./axios-C9YbA6xv.js";import{a as D}from"./js.cookie-Cz0CWeBA.js";import{c as xs,d as js}from"./quizApi-BYY7XHxr.js";import{L as b}from"./label-Dt3jQF_r.js";import{S as Qe,a as Oe,b as Ue,c as qe,d as Y}from"./select-BrlF3Ifh.js";import{d as fs}from"./problemApi-CccVGkm-.js";import{T as gs}from"./trash-BzIbQNC8.js";import{F as ys}from"./file-question-BCBC_E9U.js";import{b as vs}from"./courseApi-MeZvLjtW.js";import{u as Cs}from"./store-BpL-UjSC.js";import{L as ws}from"./overlay-DMhMuqms.js";import"./index-LgyUAq2R.js";import"./index-CbyDAWoJ.js";import"./index-BLMJFQ5A.js";/**
 * @license lucide-react v0.456.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=ts("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),bs=oe({title:V().min(1,"Title is required").max(50,"Title must not exceed 50 characters"),description:V().min(1,"Description is required"),isActive:U()});function Ve({chapter:t,onSave:s,onCancel:i}){const a=ie({resolver:de(bs),defaultValues:t||{title:"",description:"",isActive:!0}});m.useEffect(()=>{t&&a.reset({title:t.title,description:t.description,timeEstimation:t.timeEstimation,isActive:t.isActive})},[t,a]);const h=a.handleSubmit(l=>{s(t?{...t,...l}:l)});return e.jsx(ce,{...a,children:e.jsx(Fe,{...a,children:e.jsxs("form",{onSubmit:h,className:"space-y-8",children:[e.jsxs("div",{className:"px-6 py-4",children:[e.jsx(I,{control:a.control,name:"title",render:({field:l})=>e.jsxs(P,{children:[e.jsx($,{children:"Title"}),e.jsx(R,{children:e.jsx(z,{...l})}),e.jsx(_,{})]})}),e.jsx(me,{control:a.control,name:"description",label:"Description",placeholder:"Enter chapter description..."}),e.jsx(I,{control:a.control,name:"isActive",render:({field:l})=>e.jsxs(P,{className:"flex flex-row items-center justify-between p-4 border rounded-lg",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx($,{className:"text-base",children:"Active"})}),e.jsx(R,{children:e.jsx(q,{checked:l.value,onCheckedChange:l.onChange})})]})})]}),e.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>i(),children:"Cancel"}),e.jsx(d,{type:"submit",children:"Save Chapter"})]})]})})})}function Ls({chapter:t,onEdit:s,onDelete:i}){const a=()=>{t&&t.id&&s(t.id)};return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold",children:t.title}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(d,{variant:"ghost",size:"sm",onClick:a,children:[e.jsx(le,{className:"mr-2"}),"Edit"]}),e.jsxs(ze,{children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(d,{variant:"ghost",size:"sm",children:[e.jsx(S,{className:"mr-2"}),"Delete"]})}),e.jsxs(Ee,{children:[e.jsxs(ke,{children:[e.jsx(Se,{children:"Are you sure you want to delete this chapter?"}),e.jsx(Ie,{children:"This action cannot be undone. This will permanently delete the chapter and all its lectures."})]}),e.jsxs(Pe,{children:[e.jsx($e,{children:"Cancel"}),e.jsx(Re,{onClick:()=>t.id&&i(t.id),children:"Delete"})]})]})]}),e.jsx("span",{className:`px-2 py-1 rounded ${t.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.isActive?"Active":"Inactive"})]})]})}const Ts="https://localhost:5000",Ce=async(t,s)=>{try{return(await ps.post(`${Ts}/learning-service/lectures/${s}/files`,t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${D.get("authToken")}`}})).data}catch(i){throw console.error("Error creating file:",i),i}},Ds=async(t,s)=>{try{return(await A.post(`/learning-service/chapters/${t}/lectures`,s,{headers:{Authorization:`Bearer ${D.get("authToken")}`}})).data}catch(i){throw console.error("Error creating course:",i),i}},Fs=async t=>{try{return(await A.get(`/learning-service/lectures/${t}/details`,{headers:{Authorization:`Bearer ${D.get("authToken")}`}})).data}catch(s){throw console.error("Error creating course:",s),s}},zs=async(t,s,i)=>{try{return(await A.put(`/learning-service/chapters/${t}/lectures/${s}`,{lecture:i},{headers:{Authorization:`Bearer ${D.get("authToken")}`}})).data}catch(a){throw console.error("Error updating lecture:",a),a}},As=async(t,s)=>{try{return(await A.delete(`/learning-service/chapters/${t}/lectures/${s}`,{headers:{Authorization:`Bearer ${D.get("authToken")}`}})).data}catch(i){throw console.error("Error deleting lecture:",i),i}},we=async(t,s)=>{try{return(await A.delete(`/learning-service/lectures/${s}/files/${t}`,{headers:{Authorization:`Bearer ${D.get("authToken")}`}})).data}catch(i){throw console.error("Error deleting file:",i),i}},Es=oe({title:V().min(1,"Title is required"),description:V().min(1,"Description is required"),passingMark:ne.number().int("Passing mark must be an integer").min(1,"Passing mark must be a non-negative integer"),hasTimeLimit:U(),timeLimit:ne.number().int("Time limit must be an integer").optional(),hasAttemptLimit:U(),attemptLimit:ne.number().int("Attempt limit must be an integer").optional(),isActive:U(),isRandomized:U(),quizType:De(["PRACTICE","FINAL"])}).superRefine((t,s)=>{t.hasTimeLimit&&(t.timeLimit===void 0?s.addIssue({code:se.custom,message:"Time limit is required when 'Has Time Limit' is enabled",path:["timeLimit"]}):t.timeLimit<1&&s.addIssue({code:se.custom,message:"Time limit must be at least 1 minute when enabled",path:["timeLimit"]})),t.hasAttemptLimit&&(t.attemptLimit===void 0?s.addIssue({code:se.custom,message:"Attempt limit is required when 'Has Attempt Limit' is enabled",path:["attemptLimit"]}):t.attemptLimit<1&&s.addIssue({code:se.custom,message:"Attempt limit must be at least 1 when enabled",path:["attemptLimit"]}))});function ks({isOpen:t,onOpenChange:s,onSubmit:i}){const a=ie({resolver:de(Es),defaultValues:{title:"",description:"",passingMark:0,hasTimeLimit:!1,timeLimit:1,hasAttemptLimit:!1,attemptLimit:1,isActive:!0,isRandomized:!1,quizType:"PRACTICE"}}),{control:h,handleSubmit:l,watch:j,formState:{errors:u}}=a,w=j("hasTimeLimit"),f=j("hasAttemptLimit"),{toast:v}=te(),F=n=>{i(n),s(!1),v({title:"Quiz Created",description:"Your quiz has been successfully created."})};return e.jsx(M,{open:t,onOpenChange:s,children:e.jsxs(G,{className:"sm:max-w-[900px] max-h-[90vh] overflow-y-auto",children:[e.jsx(J,{children:e.jsx(K,{children:"Create Quiz"})}),e.jsx(ce,{...a,children:e.jsxs("form",{onSubmit:l(F),children:[e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"title",children:"Title"}),e.jsx(T,{name:"title",control:h,render:({field:n})=>e.jsx(z,{...n,id:"title"})}),u.title&&e.jsx("p",{className:"text-sm text-red-500",children:u.title.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"passingMark",children:"Passing Mark"}),e.jsx(T,{name:"passingMark",control:h,render:({field:n})=>e.jsx(z,{...n,id:"passingMark",type:"number"})}),u.passingMark&&e.jsx("p",{className:"text-sm text-red-500",children:u.passingMark.message})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"description",children:"Description"}),e.jsx(me,{control:h,name:"description",label:"",placeholder:"Enter quiz description"}),u.description&&e.jsx("p",{className:"text-sm text-red-500",children:u.description.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{htmlFor:"hasTimeLimit",children:"Has Time Limit"}),e.jsx(T,{name:"hasTimeLimit",control:h,render:({field:n})=>e.jsx(q,{checked:n.value,onCheckedChange:n.onChange})})]}),w&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"timeLimit",children:"Time Limit (minutes)"}),e.jsx(T,{name:"timeLimit",control:h,render:({field:n})=>e.jsx(z,{...n,id:"timeLimit",type:"number"})}),u.timeLimit&&e.jsx("p",{className:"text-sm text-red-500",children:u.timeLimit.message})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{htmlFor:"hasAttemptLimit",children:"Has Attempt Limit"}),e.jsx(T,{name:"hasAttemptLimit",control:h,render:({field:n})=>e.jsx(q,{checked:n.value,onCheckedChange:n.onChange})})]}),f&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"attemptLimit",children:"Attempt Limit"}),e.jsx(T,{name:"attemptLimit",control:h,render:({field:n})=>e.jsx(z,{...n,id:"attemptLimit",type:"number"})}),u.attemptLimit&&e.jsx("p",{className:"text-sm text-red-500",children:u.attemptLimit.message})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{htmlFor:"isActive",children:"Is Active"}),e.jsx(T,{name:"isActive",control:h,render:({field:n})=>e.jsx(q,{checked:n.value,onCheckedChange:n.onChange})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{htmlFor:"isRandomized",children:"Is Randomized"}),e.jsx(T,{name:"isRandomized",control:h,render:({field:n})=>e.jsx(q,{checked:n.value,onCheckedChange:n.onChange})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"quizType",children:"Quiz Type"}),e.jsx(T,{name:"quizType",control:h,render:({field:n})=>e.jsxs(Qe,{onValueChange:n.onChange,defaultValue:n.value,children:[e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"Select quiz type"})}),e.jsxs(qe,{children:[e.jsx(Y,{value:"PRACTICE",children:"Practice"}),e.jsx(Y,{value:"FINAL",children:"Final"})]})]})})]})]}),e.jsxs(us,{className:"mt-6",children:[e.jsx(hs,{asChild:!0,children:e.jsx(d,{type:"button",variant:"secondary",children:"Cancel"})}),e.jsx(d,{type:"submit",children:"Create Quiz"})]})]})})]})})}const Ss=oe({title:V().min(1,"Title is required"),summary:V().min(1,"Summary is required"),timeEstimation:ve().min(1,"Time estimation must be at least 1 minute").max(1440,"Time estimation must not exceed 1440 minutes (24 hours)"),lectureType:De(["Lesson","Quiz","Practice"]),point:ve().min(0,"Points must be non-negative"),isFree:U()});function Me({lecture:t,onSave:s,onCancel:i}){const a=ie({resolver:de(Ss),defaultValues:t||{title:"",summary:"",timeEstimation:30,lectureType:"Lesson",point:0,isFree:!1}}),h=a.handleSubmit(l=>{s(l)});return e.jsx(ce,{...a,children:e.jsx(Fe,{...a,children:e.jsxs("form",{onSubmit:h,className:"space-y-8",children:[e.jsxs("div",{className:"pr-4",children:[e.jsx(I,{control:a.control,name:"title",render:({field:l})=>e.jsxs(P,{children:[e.jsx($,{children:"Title"}),e.jsx(R,{children:e.jsx(z,{...l})}),e.jsx(_,{})]})}),e.jsx(me,{control:a.control,name:"summary",label:"Summary",placeholder:"Enter lecture summary..."}),e.jsx(I,{control:a.control,name:"timeEstimation",render:({field:l})=>e.jsxs(P,{children:[e.jsx($,{children:"Time Estimation (minutes)"}),e.jsx(R,{children:e.jsx(z,{type:"number",...l,onChange:j=>l.onChange(parseInt(j.target.value))})}),e.jsx(_,{})]})}),e.jsx(I,{control:a.control,name:"lectureType",render:({field:l})=>e.jsxs(P,{children:[e.jsx($,{children:"Lecture Type"}),e.jsxs(Qe,{onValueChange:l.onChange,defaultValue:l.value,children:[e.jsx(R,{children:e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"Select a lecture type"})})}),e.jsxs(qe,{children:[e.jsx(Y,{value:"Lesson",children:"Lesson"}),e.jsx(Y,{value:"Quiz",children:"Quiz"}),e.jsx(Y,{value:"Practice",children:"Practice"})]})]}),e.jsx(_,{})]})}),e.jsx(I,{control:a.control,name:"point",render:({field:l})=>e.jsxs(P,{children:[e.jsx($,{children:"Point"}),e.jsx(R,{children:e.jsx(z,{type:"number",...l,onChange:j=>l.onChange(parseInt(j.target.value))})}),e.jsx(_,{})]})}),e.jsx(I,{control:a.control,name:"isFree",render:({field:l})=>e.jsxs(P,{className:"flex flex-row items-center justify-between p-4 border rounded-lg",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx($,{className:"text-base",children:"Free"})}),e.jsx(R,{children:e.jsx(q,{checked:l.value,onCheckedChange:l.onChange})})]})})]}),e.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[e.jsx(d,{type:"button",variant:"outline",onClick:i,children:"Cancel"}),e.jsx(d,{type:"submit",children:"Save Lecture"})]})]})})})}function Be({isOpen:t,onClose:s,lecture:i,onSave:a}){return te(),!t||!i?null:e.jsx(M,{open:t,onOpenChange:s,children:e.jsxs(G,{className:"w-[95vw] max-w-[1000px] max-h-[90vh] overflow-y-auto",children:[e.jsx(J,{children:e.jsx(K,{children:"Edit Lecture"})}),e.jsx(Me,{lecture:i,onSave:a,onCancel:s})]})})}function Is({chapterId:t,lecture:s,onUpdateLecture:i,onDeleteLecture:a,setIsUpdateLecture:h,isUpdateLecture:l,courseId:j}){const[u,w]=m.useState(!1),[f,v]=m.useState(!1),F=is(),[n,g]=m.useState(!1),[C,y]=m.useState(null),[E,ae]=m.useState(null),B=m.useRef(null),H=m.useRef(null),[Z,Q]=m.useState(!1),[k,re]=m.useState(null),[c,x]=m.useState(!1),{toast:o}=te();ie({defaultValues:{title:"",description:"",passingMark:0,hasTimeLimit:!1,attemptLimit:0,hasAttemptLimit:!1,isActive:!0,isRandomized:!1,quizType:"PRACTICE"}});const N=()=>{x(!0)};m.useEffect(()=>{(async()=>{try{const p=await Fs(s.id);re(p.lectureDetailsDto.quiz),y(p.lectureDetailsDto.files),ae(p.lectureDetailsDto.problem)}catch{}})()},[s.id,n]),m.useEffect(()=>{const r=()=>{document.body.style.overflow="auto",document.body.style.height="auto"};return Z||r(),()=>{r()}},[Z]);const ue=async(r,p,O)=>{try{w(!0);const L=new FormData;L.append("file",p),L.append("fileType",O);const ss=await Ce(L,r);o({title:"File uploaded",description:"The file has been successfully uploaded.",duration:1500}),g(!n)}catch{o({title:"Upload failed",description:"There was an error uploading the file.",duration:1500})}finally{w(!1)}},he=async r=>{const p=r.target.files[0];if(p)try{v(!0);const O=await as(p),L=new FormData;L.append("file",p),L.append("fileType","VIDEO"),L.append("duration",O);const ss=await Ce(L,s.id);o({title:"Video uploaded",description:"The video has been successfully uploaded.",duration:1500}),g(!n),r.target.value=null}catch{o({title:"Upload failed",description:"There was an error uploading the video.",duration:1500})}finally{v(!1)}},He=r=>{F({to:`/create-code-problem/${r.id}`})},Ze=async r=>{try{const p=await fs(r);g(!n),o({title:"Problem deleted",description:"The problem has been successfully deleted.",duration:1500})}catch{o({title:"Delete failed",description:"There was an error deleting the problem.",duration:1500})}},pe=()=>{B.current.click()},xe=()=>{H.current.click()},_e=()=>{F({to:`/edit-course/${j}/create-problem-lecture/${s.id}`})},Ye=()=>{Q(!0)},Ge=()=>{Q(!1)},je=async r=>{try{const p=await we(r,s.id);g(!n),o({title:"File deleted",description:"The file has been successfully deleted.",duration:1500})}catch{o({title:"Delete failed",description:"There was an error deleting the file.",duration:1500})}},fe=async r=>{try{const p=await we(r,s.id);g(!n),o({title:"File deleted",description:"The file has been successfully deleted.",duration:1500})}catch{o({title:"Delete failed",description:"There was an error deleting the file.",duration:1500})}},Je=async r=>{const p={createQuizDto:{...r}};try{const O=await xs(p,s.id);o({title:"Quiz created successfully",description:"Quiz created successfully",duration:1500}),g(!n),Q(!1)}catch{o({title:"Quiz creation failed",description:"There was an error creating the quiz.",duration:1500})}Ge()},Ke=r=>{F({to:`/create-question/${r}`})},We=async r=>{try{const p=await js(r);g(!n),o({title:"Quiz deleted",description:"The quiz has been successfully deleted.",duration:1500})}catch{o({title:"Delete failed",description:"There was an error deleting the quiz.",duration:1500})}},Xe=async()=>{await a(t,s.id)},es=async r=>{await i(t,s.id,r),x(!1)};return e.jsxs("div",{className:"flex flex-col p-4 mt-4 rounded-md shadow-sm bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-lg font-medium",children:s.title}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(d,{variant:"ghost",size:"sm",onClick:N,children:[e.jsx(le,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Edit lecture"})]}),e.jsxs(ze,{children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(d,{variant:"ghost",size:"sm",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Delete lecture"})]})}),e.jsxs(Ee,{children:[e.jsxs(ke,{children:[e.jsx(Se,{children:"Are you sure you want to delete this lecture?"}),e.jsx(Ie,{children:"This action cannot be undone. This will permanently delete the lecture."})]}),e.jsxs(Pe,{children:[e.jsx($e,{children:"Cancel"}),e.jsx(Re,{onClick:Xe,children:"Delete"})]})]})]}),e.jsx("span",{className:"px-2 py-1 text-sm bg-gray-200 rounded",children:s.lectureType}),e.jsxs("span",{className:"px-2 py-1 text-sm bg-gray-200 rounded",children:[s.point," points"]}),e.jsx("span",{className:`text-sm px-2 py-1 rounded ${s.isFree?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:s.isFree?"Free":"Paid"})]})]}),e.jsx(Be,{isOpen:c,onClose:()=>x(!1),lecture:s,onSave:es,chapterId:t}),s.lectureType==="Lesson"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{type:"file",ref:B,className:"hidden",onChange:r=>ue(s.id,r.target.files[0],"DOCUMENT"),accept:".pdf,.doc,.docx,.txt",multiple:!0}),e.jsx(d,{onClick:pe,size:"sm",className:"w-full sm:w-auto",children:u?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 mr-2"})," Upload Files"]})}),C&&C.map((r,p)=>r.fileType==="DOCUMENT"&&e.jsxs("div",{className:"flex items-center p-2 mt-2 bg-white rounded-md",children:[e.jsx(X,{className:"w-4 h-4 mr-2 text-blue-500"}),e.jsx("span",{className:"flex-grow text-sm truncate",children:r.fileName}),e.jsxs(d,{onClick:()=>fe(r.fileId),size:"sm",variant:"ghost",className:"ml-2",children:[e.jsx(S,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"sr-only",children:"Remove file"})]})]},r.fileId))]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",ref:H,className:"hidden",onChange:he,accept:"video/*",multiple:!0}),e.jsx(d,{onClick:xe,size:"sm",className:"w-full sm:w-auto",disabled:C&&C.some(r=>r.fileType==="VIDEO"),children:f?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[" ",e.jsx(ee,{className:"w-4 h-4 mr-2"})," Upload Video"]})}),C&&C.map((r,p)=>r.fileType==="VIDEO"&&e.jsxs("div",{className:"flex items-center p-2 mt-2 bg-white rounded-md",children:[e.jsx(ee,{className:"w-4 h-4 mr-2 text-blue-500"}),e.jsx("span",{className:"flex-grow text-sm truncate",children:r.fileName}),e.jsxs(d,{onClick:()=>je(r.fileId),size:"sm",variant:"ghost",className:"ml-2",children:[e.jsx(S,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"sr-only",children:"Remove video"})]})]},p))]})]}),s.lectureType==="Practice"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{type:"file",ref:B,className:"hidden",onChange:r=>ue(s.id,r.target.files[0],"DOCUMENT"),accept:".pdf,.doc,.docx,.txt",multiple:!0}),e.jsx(d,{onClick:pe,size:"sm",className:"w-full sm:w-auto",children:u?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 mr-2"})," Upload Files"]})}),C&&C.map((r,p)=>r.fileType==="DOCUMENT"&&e.jsxs("div",{className:"flex items-center p-2 mt-2 bg-white rounded-md",children:[e.jsx(X,{className:"w-4 h-4 mr-2 text-blue-500"}),e.jsx("span",{className:"flex-grow text-sm truncate",children:r.fileName}),e.jsxs(d,{onClick:()=>fe(r.fileId),size:"sm",variant:"ghost",className:"ml-2",children:[e.jsx(S,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"sr-only",children:"Remove file"})]})]},r.fileName))]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",ref:H,className:"hidden",onChange:he,accept:"video/*",multiple:!0}),e.jsx(d,{onClick:xe,size:"sm",className:"w-full sm:w-auto",disabled:C&&C.some(r=>r.fileType==="VIDEO"),children:f?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[" ",e.jsx(ee,{className:"w-4 h-4 mr-2"})," Upload Video"]})}),C&&C.map((r,p)=>r.fileType==="VIDEO"&&e.jsxs("div",{className:"flex items-center p-2 mt-2 bg-white rounded-md",children:[e.jsx(ee,{className:"w-4 h-4 mr-2 text-blue-500"}),e.jsx("span",{className:"flex-grow text-sm truncate",children:r.fileName}),e.jsxs(d,{onClick:()=>je(r.fileId),size:"sm",variant:"ghost",className:"ml-2",children:[e.jsx(S,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"sr-only",children:"Remove video"})]})]}))]}),e.jsxs(d,{onClick:_e,size:"sm",className:"w-full sm:w-auto",disabled:E,children:[e.jsx(ye,{className:"w-4 h-4 mr-2"})," Create Code Problem"]}),E&&e.jsxs("div",{className:"flex items-center p-2 mt-2 bg-white rounded-md",children:[e.jsx(ye,{className:"w-4 h-4 mr-2 text-blue-500"}),e.jsx("span",{className:"flex-grow text-sm truncate",children:E.title}),e.jsxs(d,{onClick:()=>He(),size:"sm",variant:"ghost",className:"ml-2",children:[e.jsx(Ns,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"sr-only",children:"Edit problem"})]}),e.jsxs(d,{onClick:()=>Ze(E.id),size:"sm",variant:"ghost",className:"ml-2",children:[e.jsx(gs,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"sr-only",children:"Delete problem"})]})]},E.id)]}),s.lectureType==="Quiz"&&e.jsxs("div",{className:"mt-2",children:[e.jsxs(d,{onClick:Ye,size:"sm",className:"w-full sm:w-auto",children:[e.jsx(ms,{className:"w-4 h-4 mr-2"})," Create Quiz"]}),k&&e.jsxs("div",{className:"flex items-center p-2 mt-2 bg-white rounded-md",children:[e.jsx(ys,{className:"w-4 h-4 mr-2 text-blue-500"}),e.jsx("span",{className:"flex-grow text-sm truncate",children:k.title}),e.jsx(d,{onClick:()=>Ke(k.id),size:"sm",variant:"outline",className:"ml-2",children:e.jsx(le,{className:"w-4 h-4 mr-2"})}),e.jsx(d,{onClick:()=>We(k.id),size:"sm",variant:"destructive",className:"ml-2",children:e.jsx(S,{className:"w-4 h-4 mr-2"})})]},k.id)]}),e.jsx(ks,{isOpen:Z,onOpenChange:Q,onSubmit:Je})]})}function Ps({chapterId:t,lectures:s,chapterIndex:i,onAddLecture:a,onUpdateLecture:h,onDeleteLecture:l,courseId:j,setIsUpdate:u,isUpdate:w}){return e.jsxs(e.Fragment,{children:[e.jsx(M,{children:e.jsx(Te,{asChild:!0,children:e.jsxs(d,{className:"mt-2",onClick:a,children:[e.jsx(Le,{className:"mr-2"})," Add Lecture"]})})}),s.map((f,v)=>e.jsx(Is,{chapterId:t,lecture:f,onUpdateLecture:h,onDeleteLecture:l,courseId:j,setIsUpdateLecture:u,isUpdateLecture:w},v))]})}function $s({curriculum:t,courseId:s,onEditChapter:i,onDeleteChapter:a,onAddLecture:h,onUpdateLecture:l,onDeleteLecture:j,setIsUpdate:u,isUpdate:w}){return t.map((f,v)=>e.jsx(Ne,{className:"w-full p-6 mb-6",children:e.jsxs("div",{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(Ls,{chapter:f.chapterDto,onEdit:()=>i(f.chapterDto.id),onDelete:()=>a(f.chapterDto.id)}),e.jsx(Ps,{chapterId:f.chapterDto.id,lectures:f.lectureDtos,chapterIndex:v,onAddLecture:()=>h(f.chapterDto.id),onUpdateLecture:l,onDeleteLecture:j,courseId:s,setIsUpdate:u,isUpdate:w})]})},v))}function Rs({isOpen:t,onClose:s,onSave:i}){return e.jsx(M,{open:t,onOpenChange:s,children:e.jsxs(G,{className:"w-[95vw] max-w-[1000px] max-h-[90vh] overflow-y-auto",children:[e.jsx(J,{children:e.jsx(K,{children:"Add New Lecture"})}),e.jsx(Me,{onSave:i,onCancel:s})]})})}function Qs({isOpen:t,onClose:s,chapter:i,onSave:a}){return!t||!i?null:e.jsx(M,{open:t,onOpenChange:s,children:e.jsxs(G,{className:"w-[95vw] max-w-[1000px] max-h-[90vh] overflow-y-auto",children:[e.jsx(J,{children:e.jsx(K,{children:"Edit Chapter"})}),e.jsx(Ve,{chapter:i,onSave:h=>{a(h),s()},onCancel:s})]})})}const Os=async(t,s)=>{try{return(await A.post(`/learning-service/courses/${s}/chapters`,t,{headers:{Authorization:`Bearer ${D.get("authToken")}`}})).data}catch(i){throw console.error("Error creating course:",i),i}},Us=async(t,s,i)=>{try{return(await A.put(`/learning-service/courses/${s}/chapters/${i}`,t,{headers:{Authorization:`Bearer ${D.get("authToken")}`}})).data}catch(a){throw console.error("Error updating chapter:",a),a}},qs=async(t,s)=>{try{return(await A.delete(`/learning-service/courses/${t}/chapters/${s}`,{headers:{Authorization:`Bearer ${D.get("authToken")}`}})).data}catch(i){throw console.error("Error deleting chapter:",i),i}},Vs=({chapter:t,handleUpdateChapter:s,courseId:i})=>{const[a,h]=m.useState(!1),[l,j]=m.useState(!1),[u,w]=m.useState(null);m.useState(null);const[f,v]=m.useState(!1),[F,n]=m.useState(null),[g,C]=m.useState(null),{toast:y}=te();m.useEffect(()=>{const c=()=>{document.body.style.overflow="auto",document.body.style.height="auto"};return!l&&u===null&&!f&&g===null&&c(),()=>{c()}},[l,u,f,g,a]);const E=c=>{const x=t.find(o=>o.chapterDto&&o.chapterDto.id===c);x?w(x.chapterDto):y({title:"Error",description:"Could not find chapter to edit",variant:"destructive"})},ae=async c=>{try{const x={chapter:{title:c.title,description:c.description,isActive:c.isActive}};await Us(x,i,c.id),s(),w(null),y({title:"Chapter updated successfully",description:"The chapter has been updated."})}catch{y({title:"Error",description:"Failed to update the chapter. Please try again.",variant:"destructive"})}},B=m.useCallback(async(c,x,o)=>{try{await zs(c,x,o),s(),y({title:"Lecture updated successfully",description:"The lecture has been updated."})}catch{y({title:"Error",description:"Failed to update the lecture. Please try again.",variant:"destructive"})}},[s,y]),H=m.useCallback(async(c,x)=>{try{await As(c,x),s(),y({title:"Lecture deleted successfully",description:"The lecture has been removed."})}catch{y({title:"Error",description:"Failed to delete the lecture. Please try again.",variant:"destructive"})}},[s,y]),Z=async(c,x)=>{const o={createChapterDto:{...c}};try{const N=await Os(o,x);y({title:"Chapter created successfully",description:"Chapter created successfully"}),j(!1),s()}catch{}},Q=async c=>{try{await qs(i,c),s(),y({title:"Chapter deleted successfully",description:"The chapter has been removed."})}catch{y({title:"Error",description:"Failed to delete the chapter. Please try again.",variant:"destructive"})}},k=async(c,x)=>{const o={createLectureDto:{...x}};try{const N=await Ds(c,o);y({title:"Lecture created successfully",description:"Lecture created successfully"}),v(!1),s()}catch{}},re=(c,x,o)=>{const N=[...curriculum];N[x].lectures[o]={...N[x].lectures[o],...c},setCurriculum(N),C(null),y({title:"Lecture updated",description:"The lecture has been successfully updated.",duration:1500})};return e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"mb-4 text-2xl font-semibold",children:"Curriculum"}),e.jsxs(M,{open:l,onOpenChange:j,children:[e.jsx(Te,{asChild:!0,children:e.jsxs(d,{className:"mb-4",onClick:()=>j(!0),children:[e.jsx(Le,{className:"mr-2"})," Add Chapter"]})}),e.jsxs(G,{className:"w-[95vw] max-w-[1000px] max-h-[90vh] overflow-y-auto",children:[e.jsx(J,{children:e.jsx(K,{children:"Add New Chapter"})}),e.jsx(Ve,{onSave:c=>Z(c,i),onCancel:()=>j(!1)})]})]}),e.jsx($s,{setIsUpdate:h,isUpdate:a,curriculum:t,onEditChapter:E,onDeleteChapter:Q,onAddLecture:c=>{n(c),v(!0)},onUpdateLecture:B,onDeleteLecture:H,courseId:i}),e.jsx(Rs,{isOpen:f,onClose:()=>v(!1),onSave:c=>k(F,c)}),u&&e.jsx(Qs,{isOpen:u!==null,onClose:()=>w(null),chapter:u,onSave:ae}),e.jsx(Be,{isOpen:g!==null,onClose:()=>C(null),lecture:g==null?void 0:g.lecture,onSave:c=>re(c,g.chapterIndex,g.lectureIndex)})]})},Ms=be.memo(Vs),Bs=()=>{const{params:t}=rs(ns.id),{courseId:s}=t,{setCourseIdToBack:i}=Cs(),[a,h]=m.useState(null),[l,j]=m.useState(null),[u,w]=m.useState(!1);m.useEffect(()=>{(async()=>{try{const n=await vs(s);console.log(n),i(s),h(n.courseDetailsDto.courseDto),j(n.courseDetailsDto.chapterDetailsDtos),console.log(n.courseDetailsDto.chapterDetailsDtos)}catch(n){console.error("Failed to fetch course details:",n)}})()},[u]);const f=()=>{w(!u)},v=()=>{console.log("Edit info button clicked"),alert("Edit course info functionality to be implemented")};return a?e.jsxs("div",{className:"flex flex-col lg:flex-row min-h-screen",children:[e.jsx("div",{className:"w-full lg:w-1/4 p-4 overflow-auto",children:e.jsxs(Ne,{children:[e.jsx(ls,{children:e.jsx("img",{src:a.imageUrl,alt:"Course Image",className:"w-full h-48 object-cover rounded-t-lg"})}),e.jsxs(cs,{className:"space-y-4",children:[e.jsx(os,{className:"text-xl lg:text-2xl",children:a.title}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-2 sm:space-y-0",children:[e.jsxs("span",{className:"text-xl lg:text-2xl font-bold",children:["$",a.price]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(ge,{variant:"secondary",children:a.courseLevel}),e.jsx(ge,{variant:"outline",children:a.courseStatus})]})]}),e.jsx(ds,{}),e.jsx("p",{className:"text-sm lg:text-base text-muted-foreground",children:a.headline}),e.jsx(d,{onClick:v,className:"w-full mt-4",children:"Edit Info"})]})]})}),e.jsx("div",{className:"w-full lg:w-3/4 p-4 overflow-auto",children:e.jsx(Ms,{chapter:l,courseId:s,handleUpdateChapter:f})})]}):e.jsx(ws,{})},xt=be.memo(Bs);export{xt as default};
//# sourceMappingURL=EditCurriculumCourse-BiCTmPQD.js.map
