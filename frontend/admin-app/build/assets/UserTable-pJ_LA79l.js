import{c as K,r as i,j as e,E as j,L as H}from"./index--0QK1py9.js";import{P as z}from"./page-container-gCBPxlHn.js";import{u as B,g as $,b as q,c as G,d as W,e as _,f as J,T as k,h as Q,i as A,j as X,a as R,E as Y}from"./index-BKt1igTs.js";import{I as E}from"./index-DCCljha-.js";import{D as b,a as y,b as w,i as Z,g as T,h as D,c as ee,f as S,d as se}from"./dropdown-menu-euPneD8I.js";import{D as I,a as P,b as F,c as U,d as V,g as te}from"./dialog-Bx1Lxwmr.js";import{A as ae,a as re,b as le}from"./avatar-DGf8gLQP.js";import{B as L}from"./badge-v9T6Y60L.js";import{l as ie,g as ne,u as oe,a as ce}from"./userApi-OrmznZaf.js";import{u as O}from"./use-toast-BSHZ4QUe.js";import{L as de}from"./link-KhjbQdx0.js";import{A as ue}from"./arrow-up-down-BZN0NgwW.js";import{C as M}from"./check-Byk2faK-.js";import{A as me,a as he,b as xe}from"./alert-BiUXOAaq.js";import"./sidebar-BaYd8Gqy.js";import"./index-goUZiQpb.js";import"./tooltip-CP8HNIJZ.js";import"./index-CaMr_zbb.js";import"./index-Dxmo-grb.js";import"./axios-CCb-kr4I.js";/**
 * @license lucide-react v0.456.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=K("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);function je({columns:t,data:l}){var v,C;const[n,f]=i.useState([]),[o,c]=i.useState([]),[m,d]=i.useState({}),[h,x]=i.useState({}),[u,g]=i.useState(l),a=B({data:u,columns:t,onSortingChange:f,onColumnFiltersChange:c,getCoreRowModel:$(),getPaginationRowModel:q(),getSortedRowModel:G(),getFilteredRowModel:W(),onColumnVisibilityChange:d,onRowSelectionChange:x,state:{sorting:n,columnFilters:o,columnVisibility:m,rowSelection:h}}),p=s=>{g(r=>r.map(N=>N.id===s.id?s:N))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(E,{placeholder:"Filter usernames...",value:((v=a.getColumn("userName"))==null?void 0:v.getFilterValue())??"",onChange:s=>{var r;return(r=a.getColumn("userName"))==null?void 0:r.setFilterValue(s.target.value)},className:"max-w-sm"}),e.jsxs(b,{children:[e.jsx(y,{asChild:!0,children:e.jsx(j,{variant:"outline",children:"Columns"})}),e.jsx(w,{align:"end",children:a.getAllColumns().filter(s=>s.getCanHide()).map(s=>e.jsx(Z,{className:"capitalize",checked:s.getIsVisible(),onCheckedChange:r=>s.toggleVisibility(!!r),children:s.id},s.id))})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(_,{children:[e.jsx(J,{children:a.getHeaderGroups().map(s=>e.jsx(k,{children:s.headers.map(r=>e.jsx(Q,{children:r.isPlaceholder?null:A(r.column.columnDef.header,r.getContext())},r.id))},s.id))}),e.jsx(X,{children:(C=a.getRowModel().rows)!=null&&C.length?a.getRowModel().rows.map(s=>e.jsx(k,{"data-state":s.getIsSelected()&&"selected",children:s.getVisibleCells().map(r=>e.jsx(R,{children:A(r.column.columnDef.cell,{...r.getContext(),onDataChange:p})},r.id))},s.id)):e.jsx(k,{children:e.jsx(R,{colSpan:t.length,className:"h-24 text-center",children:"No results."})})})]})}),e.jsx("div",{className:"flex items-center justify-end space-x-2",children:e.jsxs("div",{className:"space-x-2",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:()=>a.previousPage(),disabled:!a.getCanPreviousPage(),children:"Previous"}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>a.nextPage(),disabled:!a.getCanNextPage(),children:"Next"})]})})]})}function fe({isOpen:t,onClose:l,userId:n,onLockAccount:f}){const[o,c]=i.useState(""),[m,d]=i.useState(!1),{toast:h}=O(),x=new Date(Date.now()+30*60*1e3).toISOString().slice(0,16),u=a=>{if(!a)return!0;const p=new Date(a).getTime(),v=new Date(x).getTime();return p>=v},g=async a=>{if(a.preventDefault(),o&&!u(o)){h({title:"Error",description:"Lockout time must be at least 30 minutes from now.",variant:"destructive",duration:3e3});return}d(!0);try{const p=new Date(o).toISOString();await ie(n,p),h({title:"Success",description:"Account locked successfully.",variant:"success",duration:1500}),f(p),l()}catch(p){h({title:"Error",description:p.message||"Failed to lock account. Please try again.",variant:"destructive",duration:3e3})}finally{d(!1)}};return e.jsx(I,{open:t,onOpenChange:l,children:e.jsxs(P,{children:[e.jsx(F,{children:e.jsx(U,{children:"Lock Account"})}),e.jsxs("form",{onSubmit:g,children:[e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"lockoutTime",className:"text-right",children:"Lockout Time"}),e.jsx(E,{id:"lockoutTime",type:"datetime-local",min:x,value:o,onChange:a=>c(a.target.value),onBlur:a=>{a.target.value&&!u(a.target.value)&&h({title:"Warning",description:"Lockout time must be at least 30 minutes from now.",variant:"warning",duration:3e3})},className:"col-span-3",required:!0})]})}),e.jsxs(V,{children:[e.jsx(j,{type:"button",variant:"outline",onClick:l,children:"Cancel"}),e.jsx(j,{type:"submit",disabled:m,children:m?"Locking...":"Lock Account"})]})]})]})})}const pe=[{accessorKey:"index",header:()=>e.jsx("div",{className:"font-bold text-primary text-center",children:"STT"}),cell:({row:t})=>e.jsx("div",{className:"text-center",children:t.index+1})},{accessorKey:"userName",header:({column:t})=>e.jsxs(j,{variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),className:"font-bold text-primary w-full justify-start",children:["Username",e.jsx(ue,{className:"ml-2 h-4 w-4"})]}),cell:({row:t})=>e.jsx("div",{className:"text-left pl-4",children:t.getValue("userName")})},{accessorKey:"avatar",header:()=>e.jsx("div",{className:"font-bold text-primary text-center",children:"Avatar"}),cell:({row:t})=>{const l=t.original;return e.jsx("div",{className:"flex justify-center",children:e.jsxs(ae,{children:[e.jsx(re,{src:l.urlProfilePicture,alt:`${l.firstName} ${l.lastName}`}),e.jsxs(le,{children:[l.firstName[0],l.lastName[0]]})]})})}},{accessorKey:"email",header:()=>e.jsx("div",{className:"font-bold text-primary",children:"Email"}),cell:({row:t})=>e.jsx("div",{className:"text-left",children:t.getValue("email")})},{accessorKey:"fullName",header:()=>e.jsx("div",{className:"font-bold text-primary",children:"Full Name"}),cell:({row:t})=>{const l=t.original;return e.jsxs("div",{className:"text-left",children:[l.firstName," ",l.lastName]})}},{accessorKey:"roles",header:()=>e.jsx("div",{className:"font-bold text-primary",children:"Roles"}),cell:({row:t,onDataChange:l})=>{const[n,f]=i.useState([]),[o,c]=i.useState(!1),[m,d]=i.useState(null),[h,x]=i.useState(!1),[u,g]=i.useState(null),a=t.getValue("roles"),p=t.original.id;i.useEffect(()=>{(async()=>{c(!0),d(null);try{const r=await ne();f(r)}catch(r){d(r.message),v({title:"Error",description:"Failed to load roles. Please try again later.",variant:"destructive"})}finally{c(!1)}})()},[]);const{toast:v}=O(),C=async()=>{c(!0);try{await oe(p,u.id),v({title:"Success",description:"User role updated successfully."});const s={...t.original,roles:[u.name]};l(s)}catch{v({title:"Error",description:"Failed to update user role. Please try again.",variant:"destructive"})}finally{c(!1),x(!1)}};return o?e.jsx("div",{children:"Loading roles..."}):m?e.jsxs("div",{children:["Error: ",m]}):e.jsxs(e.Fragment,{children:[e.jsxs(b,{children:[e.jsx(y,{asChild:!0,children:e.jsx(j,{variant:"ghost",className:"h-8 p-0",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:a.map((s,r)=>e.jsx(L,{variant:"outline",className:"capitalize",children:s},r))})})}),e.jsx(w,{align:"end",children:e.jsx(T,{value:a[0],onValueChange:s=>{const r=n.find(N=>N.name===s);r&&(g(r),x(!0))},children:n.map(s=>e.jsxs(D,{value:s.name,children:[s.name,a.includes(s.name)&&e.jsx(M,{className:"ml-auto h-4 w-4"})]},s.id))})})]}),e.jsx(I,{open:h,onOpenChange:x,children:e.jsxs(P,{children:[e.jsxs(F,{children:[e.jsx(U,{children:"Confirm Role Change"}),e.jsxs(te,{children:["Are you sure you want to change the user's role to ",u==null?void 0:u.name,"?"]})]}),e.jsxs(V,{children:[e.jsx(j,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(j,{onClick:C,disabled:o,children:o?"Updating...":"Confirm"})]})]})})]})}},{accessorKey:"isAccountLocked",header:()=>e.jsx("div",{className:"font-bold text-primary text-center",children:"Account Status"}),cell:({row:t,changeData:l})=>{const[n,f]=i.useState(t.getValue("isAccountLocked")),[o,c]=i.useState(!1),m=t.original.id,d=h=>{h==="locked"&&c(!0)};return e.jsxs("div",{className:"flex justify-center",children:[e.jsxs(b,{children:[e.jsx(y,{asChild:!0,children:e.jsx(j,{variant:"ghost",className:"h-8 p-0",children:e.jsx(L,{variant:n?"destructive":"success",children:n?"Locked":"Active"})})}),e.jsx(w,{align:"end",children:e.jsxs(T,{value:n?"locked":"active",onValueChange:d,children:[e.jsxs(D,{value:"active",children:["Active",!n&&e.jsx(M,{className:"ml-auto h-4 w-4"})]}),e.jsxs(D,{value:"locked",disabled:n,children:["Locked",n&&e.jsx(ge,{className:"ml-auto h-4 w-4"})]})]})})]}),e.jsx(fe,{isOpen:o,onClose:()=>c(!1),userId:m,onLockAccount:h=>{f(!0),c(!1),l()}})]})}},{id:"actions",header:()=>e.jsx("div",{className:"font-bold text-primary text-center",children:"Actions"}),cell:({row:t})=>{const l=t.original;return e.jsx("div",{className:"flex justify-center",children:e.jsxs(b,{children:[e.jsx(y,{asChild:!0,children:e.jsxs(j,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Y,{className:"h-4 w-4"})]})}),e.jsxs(w,{align:"end",children:[e.jsx(ee,{children:"Actions"}),e.jsx(S,{onClick:()=>navigator.clipboard.writeText(l.id),children:"Copy User ID"}),e.jsx(se,{}),e.jsx(S,{children:e.jsx(de,{to:`/user-detail/${l.id}`,children:"View user details"})}),e.jsx(S,{className:"text-red-600",disabled:!0,children:"Delete user"})]})]})})}}];function ve(){const[t,l]=i.useState([]),[n,f]=i.useState(!0),[o,c]=i.useState(null);return i.useEffect(()=>{const m=new AbortController,d=m.signal;return(async()=>{var x,u;try{f(!0),c(null);const g=await ce(d);d.aborted||l(g)}catch(g){g.name==="CanceledError"||g.code==="ERR_CANCELED"||c(((u=(x=g.response)==null?void 0:x.data)==null?void 0:u.message)||g.message||"Have an error, please try again")}finally{d.aborted||f(!1)}})(),()=>{m.abort()}},[]),n?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(H,{className:"h-8 w-8 animate-spin"})}):o?e.jsxs(me,{variant:"destructive",children:[e.jsx(he,{children:"Error"}),e.jsx(xe,{children:o})]}):e.jsxs("div",{className:"container mx-auto ",children:[e.jsx("h1",{className:"text-2xl font-bold mb-5",children:"User Management"}),e.jsx(je,{columns:pe,data:t})]})}const Ce=[{label:"UserTable",href:"/user-table"}];function He(){return e.jsx(z,{breadcrumbs:Ce,children:e.jsx(ve,{})})}export{He as default};
//# sourceMappingURL=UserTable-pJ_LA79l.js.map
