import{j as e,B as T,r as u,d as z,g as G,S as D,t as X,w as Z,p as $,x as L,e as K,f as Q,n as ee}from"./index-DoHIwt5e.js";import{X as se,T as re,a as ae,b as q,c as k}from"./tabs-DT8wMpmI.js";import{A as B,a as R,b as M}from"./alert-CLuhy8yo.js";import{L as te}from"./overlay-DMhMuqms.js";import{u as H,F as V}from"./index.esm-DJd3S9K5.js";import{o as A,s as m,n as _,t as O}from"./index-BfIswrMu.js";import{I as j}from"./index-DXxv6v3I.js";import{F as Y,a as N,b as w,c as C,d as E,e as I,M as P}from"./markdown-form-field-Cwd5yOXl.js";import"./select-BrlF3Ifh.js";import{u as J}from"./use-toast-DbRgK7NN.js";import{u as ie,b as oe,e as le}from"./courseApi-MeZvLjtW.js";import{U as ne}from"./upload-C3LyUgbz.js";import{D as ce}from"./dollar-sign-B4s-kcfB.js";import{C as de}from"./chevron-right-CngcK5L1.js";import{P as me}from"./page-container-CYVt9CDH.js";import{A as ue}from"./arrow-left-Col4KDBy.js";import{B as pe}from"./book-open-DU-QPPBq.js";import{R as xe}from"./rocket-BFOvzQcH.js";import"./index-mnJ_QENl.js";import"./index-BLMJFQ5A.js";import"./label-Dt3jQF_r.js";import"./index-CbyDAWoJ.js";import"./axios-C9YbA6xv.js";import"./axios-BzDuykoy.js";import"./js.cookie-Cz0CWeBA.js";import"./sidebar-DD38i4-u.js";import"./index-LgyUAq2R.js";import"./tooltip-DVG0fl16.js";const ge=A({title:m().min(1,"Title is required").max(100,"Title must not exceed 100 characters"),headline:m().min(1,"Headline is required").max(200,"Headline must not exceed 200 characters"),prerequisites:m().min(1,"Prerequisites are required"),description:m().min(1,"Description is required"),objectives:m().min(1,"Course objectives are required"),targetAudiences:m().min(1,"Target audiences are required"),timeEstimation:_().min(1,"Estimated time must be greater than 0").max(1e3,"Estimated time must not exceed 1000 hours")});function he({onSubmit:x,initialData:n}){const s=H({resolver:O(ge),defaultValues:n}),p=s.handleSubmit(a=>{x(a)},a=>{});return e.jsx(V,{...s,children:e.jsx(Y,{...s,children:e.jsxs("form",{onSubmit:p,className:"space-y-8",children:[e.jsx(N,{control:s.control,name:"title",render:({field:a})=>e.jsxs(w,{children:[e.jsx(C,{className:"text-base",children:"Title"}),e.jsx(E,{children:e.jsx(j,{...a,placeholder:"Enter course title"})}),e.jsx(I,{})]})}),e.jsx(N,{control:s.control,name:"headline",render:({field:a})=>e.jsxs(w,{children:[e.jsx(C,{className:"text-base",children:"Headline"}),e.jsx(E,{children:e.jsx(j,{...a,placeholder:"Enter course headline"})}),e.jsx(I,{})]})}),e.jsx(P,{control:s.control,name:"description",label:"Description",placeholder:"Enter course description..."}),e.jsx(P,{control:s.control,name:"prerequisites",label:"Prerequisites",placeholder:"Enter course prerequisites..."}),e.jsx(P,{control:s.control,name:"objectives",label:"Objectives",placeholder:"Enter course objectives..."}),e.jsx(P,{control:s.control,name:"targetAudiences",label:"Target Audiences",placeholder:"Describe the target audiences..."}),e.jsx(N,{control:s.control,name:"timeEstimation",render:({field:a})=>e.jsxs(w,{children:[e.jsx(C,{className:"text-base",children:"Time Estimation (hours)"}),e.jsx(E,{children:e.jsx(j,{type:"number",step:"0.5",...a,onChange:l=>a.onChange(parseFloat(l.target.value)),placeholder:"Enter estimated course duration"})}),e.jsx(I,{})]})}),e.jsx(T,{type:"submit",children:"Next to Step 2"})]})})})}const je=5e6,W=["image/jpeg","image/jpg","image/png","image/webp"],fe=A({courseLevel:m(),image:A({fileName:m(),base64Image:m(),contentType:m().refine(x=>W.includes(x),{message:"Only .jpg, .jpeg, .png and .webp formats are supported."})}).optional(),price:_().min(0,"Price must be 0 or greater").max(1e3,"Price must not exceed 1000 USD")});function be({onSubmit:x,onChange:n,initialData:s}){const[p,a]=u.useState(s.imageUrl||null),[l,g]=u.useState(!1),{toast:f}=J(),h=u.useRef(null),r=H({resolver:O(fe),defaultValues:{...s,image:s.imageUrl?{fileName:"current-image.jpg",base64Image:s.imageUrl,contentType:"image/jpeg"}:null}});u.useEffect(()=>{r.reset({...s,image:s.imageUrl?{fileName:"current-image.jpg",base64Image:s.imageUrl,contentType:"image/jpeg"}:null}),a(s.imageUrl||null)},[s,r]);const b=r.handleSubmit(t=>{x(t),n(t)}),y=async t=>{if(t){if(t.size>je){r.setError("image",{type:"manual",message:"Image size should not exceed 5MB"});return}if(!W.includes(t.type)){r.setError("image",{type:"manual",message:"Please upload a valid image file (PNG, JPG, or WebP)"});return}g(!0);const c=p;try{const i=new FileReader;i.onloadend=async()=>{const U=i.result.split(",")[1],F={courseId:s.id,imageDto:{fileName:t.name,base64Image:U,contentType:t.type}},o=await ie(s.id,F);if(o&&o.presignedUrl)a(o.presignedUrl),r.setValue("image",{fileName:t.name,base64Image:o.presignedUrl,contentType:t.type}),n({imageUrl:o.presignedUrl}),f({title:"Image Updated",description:"Course image has been successfully updated.",variant:"default"});else throw console.error("Invalid server response:",o),new Error("Invalid response from server")},i.readAsDataURL(t)}catch(i){console.error("Error updating course image:",i),a(c),f({title:"Error",description:"Failed to update course image. Please try again.",variant:"destructive"})}finally{g(!1)}}},S=()=>{h.current.click()};return e.jsx(V,{...r,children:e.jsx(Y,{...r,children:e.jsxs("form",{onSubmit:b,className:"space-y-8",children:[e.jsx(z,{children:e.jsx(G,{className:"pt-6",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsx(D,{className:"my-6"}),e.jsx(N,{control:r.control,name:"image",render:({field:t})=>e.jsxs(w,{children:[e.jsx(C,{className:"text-base font-semibold",children:"Course Image"}),e.jsx(E,{children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[p?e.jsxs("div",{className:"group relative w-full max-w-2xl aspect-video rounded-lg overflow-hidden bg-gray-100 border-2 border-gray-200",children:[e.jsx("img",{src:p,alt:"Course preview",className:"w-full h-full object-cover",onError:c=>{console.error("Image failed to load:",p),a(null),f({title:"Error",description:"Failed to load the image. Please try uploading again.",variant:"destructive"})}}),e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(T,{type:"button",variant:"secondary",size:"sm",onClick:S,disabled:l,className:"text-white hover:text-blue-400",children:l?"Updating...":"Update Image"})})]}):e.jsx("div",{className:"w-full",children:e.jsxs("label",{htmlFor:"dropzone-file",className:"relative flex flex-col items-center justify-center w-full h-[280px] border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50/50 hover:bg-gray-50 transition-colors duration-200",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6 px-4",children:[e.jsx("div",{className:"mb-3 p-4 rounded-full bg-gray-100",children:e.jsx(ne,{className:"w-8 h-8 text-gray-500"})}),e.jsx("p",{className:"mb-2 text-sm text-gray-500",children:e.jsx("span",{className:"font-medium",children:"Click to upload"})}),e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["PNG, JPG or WebP",e.jsx("br",{}),"(Recommended: 1280x720px)"]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Max file size: 5MB"})]}),e.jsx(j,{id:"dropzone-file",type:"file",accept:"image/png,image/jpeg,image/webp",className:"hidden",onChange:c=>{var i;return y((i=c.target.files)==null?void 0:i[0])},disabled:l})]})}),e.jsx(j,{ref:h,type:"file",accept:"image/png,image/jpeg,image/webp",className:"hidden",onChange:c=>{var i;return y((i=c.target.files)==null?void 0:i[0])},disabled:l})]})}),e.jsx(I,{})]})}),e.jsx(D,{className:"my-6"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsx(N,{control:r.control,name:"price",render:({field:t})=>e.jsxs(w,{children:[e.jsx(C,{className:"text-base font-semibold",children:"Price (USD)"}),e.jsx(E,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ce,{className:"w-5 h-5 text-muted-foreground mr-2"}),e.jsx(j,{type:"number",step:"0.01",min:"0",max:"1000",...t,onChange:c=>{const i=parseFloat(c.target.value);t.onChange(i),n({price:i})},placeholder:"Enter course price",className:"w-full"})]})}),e.jsx(I,{})]})})})]})})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(T,{type:"submit",className:"w-full sm:w-auto",children:["Update Landing Page",e.jsx(de,{className:"w-4 h-4 ml-2"})]})})]})})})}function We(){const{params:x}=X(Z.id),{courseId:n}=x,s=[{label:"Course Table",href:"/course-table"},{label:"Edit Course",href:`/edit-course/${n}`}],[p,a]=u.useState("step1"),[l,g]=u.useState(null),[f,h]=u.useState(!0),[r,b]=u.useState(null),{toast:y}=J(),S=$();u.useEffect(()=>{(async()=>{try{const d=await oe(n);console.log("data",d);const v=d.courseDetailsDto.courseDto;b({...v}),h(!1)}catch(d){console.error("Error fetching course details:",d),g("Failed to load course details. Please try again."),h(!1)}})()},[n]);const t=()=>{window.confirm("Are you sure you want to leave? Your changes may not be saved.")&&S({to:"/course-table"})},c=o=>{b(d=>({...d,...o})),a("step2")},i=o=>{b(d=>({...d,...o}))},U=async o=>{h(!0),g(null);const d={updateCourseDto:{title:r.title,description:r.description,headline:r.headline,timeEstimation:r.timeEstimation,prerequisites:r.prerequisites,objectives:r.objectives,targetAudiences:r.targetAudiences,price:o.price}};try{const v=await le(n,d);console.log("Course updated successfully:",v),y({title:"Course updated successfully",description:"Your course has been updated.",duration:3e3}),S({to:"/course-table"})}catch(v){console.error("Error updating course:",v),g("There was a problem updating your course. Please try again."),y({title:"Error updating course",description:"There was a problem updating your course. Please try again.",variant:"destructive",duration:3e3})}finally{h(!1)}},F=o=>{a(o)};return f?e.jsx(te,{}):l?e.jsxs(B,{variant:"destructive",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx(R,{children:"Error"}),e.jsx(M,{children:l})]}):r?e.jsx(me,{breadcrumbs:s,children:e.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(z,{className:"shadow-lg w-full max-w-6xl mx-auto",children:[e.jsx(K,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs(Q,{className:"text-2xl sm:text-3xl font-bold",children:["Edit Course: ",r.title]}),e.jsx(ee,{className:"mt-1",children:"Update your course information"})]}),e.jsxs(T,{variant:"outline",onClick:t,className:"w-full sm:w-auto",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Back to Course List"]})]})}),e.jsxs(G,{className:"w-full",children:[l&&e.jsxs(B,{variant:"destructive",className:"mb-6",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx(R,{children:"Error"}),e.jsx(M,{children:l}),e.jsx(T,{variant:"ghost",className:"h-4 w-4 p-0 absolute top-4 right-4",onClick:()=>g(null),children:e.jsx(se,{className:"h-4 w-4"})})]}),e.jsxs(re,{value:p,onValueChange:F,className:"w-full",children:[e.jsx(ae,{className:"w-full h-auto p-0 bg-transparent border-b border-gray-200",children:e.jsxs("div",{className:"grid w-full grid-cols-2",children:[e.jsxs(q,{value:"step1",className:`
                      flex items-center justify-center px-4 sm:px-8 py-3 sm:py-4 
                      border-b-2 transition-all duration-200 text-sm sm:text-base
                      hover:text-primary hover:bg-gray-50
                      data-[state=active]:border-primary data-[state=active]:text-primary
                      data-[state=inactive]:border-transparent data-[state=inactive]:text-gray-500
                    `,children:[e.jsx(pe,{className:"w-4 h-4 sm:w-5 sm:h-5 mr-2"}),"Course Details"]}),e.jsxs(q,{value:"step2",className:`
                      flex items-center justify-center px-4 sm:px-8 py-3 sm:py-4 
                      border-b-2 transition-all duration-200 text-sm sm:text-base
                      hover:text-primary hover:bg-gray-50
                      data-[state=active]:border-primary data-[state=active]:text-primary
                      data-[state=inactive]:border-transparent data-[state=inactive]:text-gray-500
                    `,children:[e.jsx(xe,{className:"w-4 h-4 sm:w-5 sm:h-5 mr-2"}),"Landing Page"]})]})}),e.jsxs("div",{className:"mt-6 w-full",children:[e.jsx(k,{value:"step1",className:"w-full",children:e.jsx(he,{onSubmit:c,initialData:r})}),e.jsx(k,{value:"step2",className:"w-full",children:e.jsx(be,{onSubmit:U,onChange:i,initialData:r})})]})]})]})]})})}):e.jsx("div",{children:"No course data available."})}export{We as default};
//# sourceMappingURL=EditBasicInfoCourse-CiRi8WZP.js.map
