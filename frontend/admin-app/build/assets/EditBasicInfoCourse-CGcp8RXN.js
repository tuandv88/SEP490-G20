import{j as e,J as S,r as u,y as _,B as z,a3 as A,a1 as Y,a4 as K,u as Z,a5 as D,z as Q,A as $,K as ee,e as L,X as se}from"./index-CZHDJBCk.js";import{T as re,a as ae,b as q,c as R}from"./tabs-B72ujN-I.js";import{A as B,a as k,b as M}from"./alert-DkMiZX8f.js";import{L as te}from"./overlay-CchFdlc6.js";import{u as H,F as G}from"./index.esm-BBIM_QSt.js";import{o as F,s as d,n as O,t as V}from"./index-DGFZ-UbV.js";import{I as j}from"./index-CsZvwwPz.js";import{F as J,a as N,b as w,c as C,d as E,e as T,M as I}from"./markdown-form-field-DZLEdgmc.js";import"./select-DvMDIVW3.js";import{u as X}from"./use-toast-DxaFKq84.js";import{u as ie,b as oe,e as le}from"./courseApi-4Gtm13zl.js";import{U as ne}from"./upload-BkudaYyr.js";import{D as ce}from"./dollar-sign-DnbacGp8.js";import{C as de}from"./chevron-right-B2BfPifc.js";import{P as me}from"./page-container-Ci6Xf41F.js";import{X as ue}from"./x-Br18mQUL.js";import{B as pe}from"./book-open-DxhmDxZT.js";import{R as xe}from"./rocket-13oleF6K.js";import"./index-Fh3QMK6n.js";import"./index-DQUYlbEB.js";import"./label-990KbfKz.js";import"./index-CpqmcsmY.js";import"./index-Dg4EHzo4.js";import"./axios-OWqOmaEp.js";import"./axios-CCb-kr4I.js";import"./sidebar-KYnXOFLW.js";import"./index-Btbx0t0H.js";import"./tooltip-BaTE3lt9.js";const ge=F({title:d().min(1,"Title is required").max(100,"Title must not exceed 100 characters"),headline:d().min(1,"Headline is required").max(200,"Headline must not exceed 200 characters"),prerequisites:d().min(1,"Prerequisites are required"),description:d().min(1,"Description is required"),objectives:d().min(1,"Course objectives are required"),targetAudiences:d().min(1,"Target audiences are required"),timeEstimation:O().min(1,"Estimated time must be greater than 0").max(1e3,"Estimated time must not exceed 1000 hours")});function he({onSubmit:x,initialData:m}){const s=H({resolver:V(ge),defaultValues:m}),p=s.handleSubmit(a=>{x(a)},a=>{});return e.jsx(G,{...s,children:e.jsx(J,{...s,children:e.jsxs("form",{onSubmit:p,className:"space-y-8",children:[e.jsx(N,{control:s.control,name:"title",render:({field:a})=>e.jsxs(w,{children:[e.jsx(C,{className:"text-base",children:"Title"}),e.jsx(E,{children:e.jsx(j,{...a,placeholder:"Enter course title"})}),e.jsx(T,{})]})}),e.jsx(N,{control:s.control,name:"headline",render:({field:a})=>e.jsxs(w,{children:[e.jsx(C,{className:"text-base",children:"Headline"}),e.jsx(E,{children:e.jsx(j,{...a,placeholder:"Enter course headline"})}),e.jsx(T,{})]})}),e.jsx(I,{control:s.control,name:"description",label:"Description",placeholder:"Enter course description..."}),e.jsx(I,{control:s.control,name:"prerequisites",label:"Prerequisites",placeholder:"Enter course prerequisites..."}),e.jsx(I,{control:s.control,name:"objectives",label:"Objectives",placeholder:"Enter course objectives..."}),e.jsx(I,{control:s.control,name:"targetAudiences",label:"Target Audiences",placeholder:"Describe the target audiences..."}),e.jsx(N,{control:s.control,name:"timeEstimation",render:({field:a})=>e.jsxs(w,{children:[e.jsx(C,{className:"text-base",children:"Time Estimation (hours)"}),e.jsx(E,{children:e.jsx(j,{type:"number",step:"0.5",...a,onChange:l=>a.onChange(parseFloat(l.target.value)),placeholder:"Enter estimated course duration"})}),e.jsx(T,{})]})}),e.jsx(S,{type:"submit",children:"Next to Step 2"})]})})})}const je=5e6,W=["image/jpeg","image/jpg","image/png","image/webp"],be=F({courseLevel:d(),image:F({fileName:d(),base64Image:d(),contentType:d().refine(x=>W.includes(x),{message:"Only .jpg, .jpeg, .png and .webp formats are supported."})}).optional(),price:O().min(0,"Price must be 0 or greater").max(1e3,"Price must not exceed 1000 USD")});function fe({onSubmit:x,onChange:m,initialData:s}){const[p,a]=u.useState(s.imageUrl||null),[l,g]=u.useState(!1),{toast:b}=X(),h=u.useRef(null),r=H({resolver:V(be),defaultValues:{...s,image:s.imageUrl?{fileName:"current-image.jpg",base64Image:s.imageUrl,contentType:"image/jpeg"}:null}});u.useEffect(()=>{r.reset({...s,image:s.imageUrl?{fileName:"current-image.jpg",base64Image:s.imageUrl,contentType:"image/jpeg"}:null}),a(s.imageUrl||null)},[s,r]);const f=r.handleSubmit(t=>{x(t),m(t)}),y=async t=>{if(t){if(t.size>je){r.setError("image",{type:"manual",message:"Image size should not exceed 5MB"});return}if(!W.includes(t.type)){r.setError("image",{type:"manual",message:"Please upload a valid image file (PNG, JPG, or WebP)"});return}g(!0);const n=p;try{const o=new FileReader;o.onloadend=async()=>{const U=o.result.split(",")[1],c={courseId:s.id,imageDto:{fileName:t.name,base64Image:U,contentType:t.type}},i=await ie(s.id,c);if(i&&i.presignedUrl)a(i.presignedUrl),r.setValue("image",{fileName:t.name,base64Image:i.presignedUrl,contentType:t.type}),m({imageUrl:i.presignedUrl}),b({title:"Image Updated",description:"Course image has been successfully updated.",variant:"default"});else throw console.error("Invalid server response:",i),new Error("Invalid response from server")},o.readAsDataURL(t)}catch(o){console.error("Error updating course image:",o),a(n),b({title:"Error",description:"Failed to update course image. Please try again.",variant:"destructive"})}finally{g(!1)}}},P=()=>{h.current.click()};return e.jsx(G,{...r,children:e.jsx(J,{...r,children:e.jsxs("form",{onSubmit:f,className:"space-y-8",children:[e.jsx(_,{children:e.jsx(z,{className:"pt-6",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsx(A,{className:"my-6"}),e.jsx(N,{control:r.control,name:"image",render:({field:t})=>e.jsxs(w,{children:[e.jsx(C,{className:"text-base font-semibold",children:"Course Image"}),e.jsx(E,{children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[p?e.jsxs("div",{className:"group relative w-full max-w-2xl aspect-video rounded-lg overflow-hidden bg-gray-100 border-2 border-gray-200",children:[e.jsx("img",{src:p,alt:"Course preview",className:"w-full h-full object-cover",onError:n=>{console.error("Image failed to load:",p),a(null),b({title:"Error",description:"Failed to load the image. Please try uploading again.",variant:"destructive"})}}),e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(S,{type:"button",variant:"secondary",size:"sm",onClick:P,disabled:l,className:"text-white hover:text-blue-400",children:l?"Updating...":"Update Image"})})]}):e.jsx("div",{className:"w-full",children:e.jsxs("label",{htmlFor:"dropzone-file",className:"relative flex flex-col items-center justify-center w-full h-[280px] border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50/50 hover:bg-gray-50 transition-colors duration-200",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6 px-4",children:[e.jsx("div",{className:"mb-3 p-4 rounded-full bg-gray-100",children:e.jsx(ne,{className:"w-8 h-8 text-gray-500"})}),e.jsx("p",{className:"mb-2 text-sm text-gray-500",children:e.jsx("span",{className:"font-medium",children:"Click to upload"})}),e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["PNG, JPG or WebP",e.jsx("br",{}),"(Recommended: 1280x720px)"]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Max file size: 5MB"})]}),e.jsx(j,{id:"dropzone-file",type:"file",accept:"image/png,image/jpeg,image/webp",className:"hidden",onChange:n=>{var o;return y((o=n.target.files)==null?void 0:o[0])},disabled:l})]})}),e.jsx(j,{ref:h,type:"file",accept:"image/png,image/jpeg,image/webp",className:"hidden",onChange:n=>{var o;return y((o=n.target.files)==null?void 0:o[0])},disabled:l})]})}),e.jsx(T,{})]})}),e.jsx(A,{className:"my-6"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsx(N,{control:r.control,name:"price",render:({field:t})=>e.jsxs(w,{children:[e.jsx(C,{className:"text-base font-semibold",children:"Price (USD)"}),e.jsx(E,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ce,{className:"w-5 h-5 text-muted-foreground mr-2"}),e.jsx(j,{type:"number",step:"0.01",min:"0",max:"1000",...t,onChange:n=>{const o=parseFloat(n.target.value);t.onChange(o),m({price:o})},placeholder:"Enter course price",className:"w-full"})]})}),e.jsx(T,{})]})})})]})})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(S,{type:"submit",className:"w-full sm:w-auto",children:["Update Landing Page",e.jsx(de,{className:"w-4 h-4 ml-2"})]})})]})})})}function We(){const{params:x}=Y(K.id),{courseId:m}=x,s=[{label:"Course Table",href:L},{label:"Edit Course",href:se}],[p,a]=u.useState("step1"),[l,g]=u.useState(null),[b,h]=u.useState(!0),[r,f]=u.useState(null),{toast:y}=X(),P=Z();u.useEffect(()=>{(async()=>{try{const i=await oe(m);console.log("data",i);const v=i.courseDetailsDto.courseDto;f({...v}),h(!1)}catch(i){console.error("Error fetching course details:",i),g("Failed to load course details. Please try again."),h(!1)}})()},[m]);const t=c=>{f(i=>({...i,...c})),a("step2")},n=c=>{f(i=>({...i,...c}))},o=async c=>{h(!0),g(null);const i={updateCourseDto:{title:r.title,description:r.description,headline:r.headline,timeEstimation:r.timeEstimation,prerequisites:r.prerequisites,objectives:r.objectives,targetAudiences:r.targetAudiences,price:c.price}};try{const v=await le(m,i);console.log("Course updated successfully:",v),y({title:"Course updated successfully",description:"Your course has been updated.",duration:3e3}),P({to:L})}catch(v){console.error("Error updating course:",v),g("There was a problem updating your course. Please try again."),y({title:"Error updating course",description:"There was a problem updating your course. Please try again.",variant:"destructive",duration:3e3})}finally{h(!1)}},U=c=>{a(c)};return b?e.jsx(te,{}):l?e.jsxs(B,{variant:"destructive",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx(k,{children:"Error"}),e.jsx(M,{children:l})]}):r?e.jsx(me,{breadcrumbs:s,children:e.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(_,{className:"shadow-lg w-full max-w-6xl mx-auto",children:[e.jsx(Q,{children:e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsxs("div",{children:[e.jsxs($,{className:"text-2xl sm:text-3xl font-bold",children:["Edit Course: ",r.title]}),e.jsx(ee,{className:"mt-1",children:"Update your course information"})]})})}),e.jsxs(z,{className:"w-full",children:[l&&e.jsxs(B,{variant:"destructive",className:"mb-6",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx(k,{children:"Error"}),e.jsx(M,{children:l}),e.jsx(S,{variant:"ghost",className:"h-4 w-4 p-0 absolute top-4 right-4",onClick:()=>g(null),children:e.jsx(ue,{className:"h-4 w-4"})})]}),e.jsxs(re,{value:p,onValueChange:U,className:"w-full",children:[e.jsx(ae,{className:"w-full h-auto p-0 bg-transparent border-b border-gray-200",children:e.jsxs("div",{className:"grid w-full grid-cols-2",children:[e.jsxs(q,{value:"step1",className:`
                      flex items-center justify-center px-4 sm:px-8 py-3 sm:py-4 
                      border-b-2 transition-all duration-200 text-sm sm:text-base
                      hover:text-primary hover:bg-gray-50
                      data-[state=active]:border-primary data-[state=active]:text-primary
                      data-[state=inactive]:border-transparent data-[state=inactive]:text-gray-500
                    `,children:[e.jsx(pe,{className:"w-4 h-4 sm:w-5 sm:h-5 mr-2"}),"Course Details"]}),e.jsxs(q,{value:"step2",className:`
                      flex items-center justify-center px-4 sm:px-8 py-3 sm:py-4 
                      border-b-2 transition-all duration-200 text-sm sm:text-base
                      hover:text-primary hover:bg-gray-50
                      data-[state=active]:border-primary data-[state=active]:text-primary
                      data-[state=inactive]:border-transparent data-[state=inactive]:text-gray-500
                    `,children:[e.jsx(xe,{className:"w-4 h-4 sm:w-5 sm:h-5 mr-2"}),"Landing Page"]})]})}),e.jsxs("div",{className:"mt-6 w-full",children:[e.jsx(R,{value:"step1",className:"w-full",children:e.jsx(he,{onSubmit:t,initialData:r})}),e.jsx(R,{value:"step2",className:"w-full",children:e.jsx(fe,{onSubmit:o,onChange:n,initialData:r})})]})]})]})]})})}):e.jsx("div",{children:"No course data available."})}export{We as default};
//# sourceMappingURL=EditBasicInfoCourse-CGcp8RXN.js.map
