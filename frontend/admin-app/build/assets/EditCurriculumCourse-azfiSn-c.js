import{c as as,r as u,j as e,J as m,M as E,u as is,L as K,Z as rs,_ as ns,$ as ls,a0 as cs,y as Ne,R as be,a1 as os,a2 as ds,z as ms,B as us,A as hs,a3 as ps,e as xs,W as js}from"./index-CZHDJBCk.js";import{B as fe}from"./badge-DPmApw2E.js";import{I as F,P as Te,b as Q,F as X,V as ee,c as ge,Q as fs,d as Le}from"./index-CsZvwwPz.js";import{D as q,a as W,b as Y,c as G,d as gs,e as ys,f as De}from"./dialog-BCM82MyM.js";import{u as te}from"./use-toast-DxaFKq84.js";import{u as ae,F as le,C as D}from"./index.esm-BBIM_QSt.js";import{o as ce,s as V,b as $,t as oe,c as ne,e as Ee,Z as se,n as ye}from"./index-DGFZ-UbV.js";import{F as Ae,a as S,b as I,c as P,d as R,e as Z,M as de}from"./markdown-form-field-DZLEdgmc.js";import{S as M,A as Fe,a as ze,b as ke,c as Se,d as Ie,e as Pe,f as Re,g as Ue,h as Oe}from"./alert-dialog-B_LYbhSY.js";import{a as z}from"./axios-OWqOmaEp.js";import{a as vs}from"./axios-CCb-kr4I.js";import{c as Cs,d as ws}from"./quizApi-CEy-0W2a.js";import{L as b}from"./label-990KbfKz.js";import{S as Qe,a as $e,b as Me,c as Ve,d as J}from"./select-DvMDIVW3.js";import{d as Ns}from"./problemApi-DwmKlxuZ.js";import{T as ve}from"./trash-HEOqW48u.js";import{F as bs}from"./file-question-Bk9z1FEJ.js";import{P as Ts}from"./plus-CFaGAQ22.js";import{b as Ls}from"./courseApi-4Gtm13zl.js";import{u as Ds}from"./store-McFJQSf3.js";import{L as Es}from"./overlay-CchFdlc6.js";import{P as As}from"./page-container-Ci6Xf41F.js";import"./index-Btbx0t0H.js";import"./index-CpqmcsmY.js";import"./index-Dg4EHzo4.js";import"./index-DQUYlbEB.js";import"./sidebar-KYnXOFLW.js";import"./tooltip-BaTE3lt9.js";/**
 * @license lucide-react v0.456.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=as("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),zs=ce({title:V().min(1,"Title is required").max(50,"Title must not exceed 50 characters"),description:V().min(1,"Description is required"),isActive:$()});function qe({chapter:t,onSave:s,onCancel:a}){const r=ae({resolver:oe(zs),defaultValues:t||{title:"",description:"",isActive:!0}});u.useEffect(()=>{t&&r.reset({title:t.title,description:t.description,timeEstimation:t.timeEstimation,isActive:t.isActive})},[t,r]);const c=r.handleSubmit(n=>{s(t?{...t,...n}:n)});return e.jsx(le,{...r,children:e.jsx(Ae,{...r,children:e.jsxs("form",{onSubmit:c,className:"space-y-8",children:[e.jsxs("div",{className:"px-6 py-4",children:[e.jsx(S,{control:r.control,name:"title",render:({field:n})=>e.jsxs(I,{children:[e.jsx(P,{children:"Title"}),e.jsx(R,{children:e.jsx(F,{...n})}),e.jsx(Z,{})]})}),e.jsx(de,{control:r.control,name:"description",label:"Description",placeholder:"Enter chapter description..."}),e.jsx(S,{control:r.control,name:"isActive",render:({field:n})=>e.jsxs(I,{className:"flex flex-row items-center justify-between p-4 border rounded-lg",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx(P,{className:"text-base",children:"Active"})}),e.jsx(R,{children:e.jsx(M,{checked:n.value,onCheckedChange:n.onChange})})]})})]}),e.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>a(),children:"Cancel"}),e.jsx(m,{type:"submit",children:"Save Chapter"})]})]})})})}function ks({chapter:t,onEdit:s,onDelete:a}){const r=()=>{t&&t.id&&s(t.id)};return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold",children:t.title}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(m,{variant:"ghost",size:"sm",onClick:r,children:[e.jsx(Te,{className:"mr-2"}),"Edit"]}),e.jsxs(Fe,{children:[e.jsx(ze,{asChild:!0,children:e.jsxs(m,{variant:"ghost",size:"sm",children:[e.jsx(Q,{className:"mr-2"}),"Delete"]})}),e.jsxs(ke,{children:[e.jsxs(Se,{children:[e.jsx(Ie,{children:"Are you sure you want to delete this chapter?"}),e.jsx(Pe,{children:"This action cannot be undone. This will permanently delete the chapter and all its lectures."})]}),e.jsxs(Re,{children:[e.jsx(Ue,{children:"Cancel"}),e.jsx(Oe,{onClick:()=>t.id&&a(t.id),children:"Delete"})]})]})]}),e.jsx("span",{className:`px-2 py-1 rounded ${t.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.isActive?"Active":"Inactive"})]})]})}const Ss="https://localhost:5000",Ce=async(t,s)=>{try{return(await vs.post(`${Ss}/learning-service/lectures/${s}/files`,t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${E.get("authToken")}`}})).data}catch(a){throw console.error("Error creating file:",a),a}},Is=async(t,s)=>{try{return(await z.post(`/learning-service/chapters/${t}/lectures`,s,{headers:{Authorization:`Bearer ${E.get("authToken")}`}})).data}catch(a){throw console.error("Error creating course:",a),a}},Ps=async t=>{try{return(await z.get(`/learning-service/lectures/${t}/details`,{headers:{Authorization:`Bearer ${E.get("authToken")}`}})).data}catch(s){throw console.error("Error creating course:",s),s}},Rs=async(t,s,a)=>{try{return(await z.put(`/learning-service/chapters/${t}/lectures/${s}`,{lecture:a},{headers:{Authorization:`Bearer ${E.get("authToken")}`}})).data}catch(r){throw console.error("Error updating lecture:",r),r}},Us=async(t,s)=>{try{return(await z.delete(`/learning-service/chapters/${t}/lectures/${s}`,{headers:{Authorization:`Bearer ${E.get("authToken")}`}})).data}catch(a){throw console.error("Error deleting lecture:",a),a}},we=async(t,s)=>{try{return(await z.delete(`/learning-service/lectures/${s}/files/${t}`,{headers:{Authorization:`Bearer ${E.get("authToken")}`}})).data}catch(a){throw console.error("Error deleting file:",a),a}},Os=ce({title:V().min(1,"Title is required"),description:V().min(1,"Description is required"),passingMark:ne.number().int("Passing mark must be an integer").min(1,"Passing mark must be a non-negative integer"),hasTimeLimit:$(),timeLimit:ne.number().int("Time limit must be an integer").optional(),hasAttemptLimit:$(),attemptLimit:ne.number().int("Attempt limit must be an integer").optional(),isActive:$(),isRandomized:$(),quizType:Ee(["PRACTICE","FINAL"])}).superRefine((t,s)=>{t.hasTimeLimit&&(t.timeLimit===void 0?s.addIssue({code:se.custom,message:"Time limit is required when 'Has Time Limit' is enabled",path:["timeLimit"]}):t.timeLimit<1&&s.addIssue({code:se.custom,message:"Time limit must be at least 1 minute when enabled",path:["timeLimit"]})),t.hasAttemptLimit&&(t.attemptLimit===void 0?s.addIssue({code:se.custom,message:"Attempt limit is required when 'Has Attempt Limit' is enabled",path:["attemptLimit"]}):t.attemptLimit<1&&s.addIssue({code:se.custom,message:"Attempt limit must be at least 1 when enabled",path:["attemptLimit"]}))});function Qs({isOpen:t,onOpenChange:s,onSubmit:a}){const r=ae({resolver:oe(Os),defaultValues:{title:"",description:"",passingMark:0,hasTimeLimit:!1,timeLimit:1,hasAttemptLimit:!1,attemptLimit:1,isActive:!0,isRandomized:!1,quizType:"PRACTICE"}}),{control:c,handleSubmit:n,watch:j,formState:{errors:h}}=r,v=j("hasTimeLimit"),g=j("hasAttemptLimit"),{toast:C}=te(),T=l=>{a(l),s(!1),C({title:"Quiz Created",description:"Your quiz has been successfully created."})};return e.jsx(q,{open:t,onOpenChange:s,children:e.jsxs(W,{className:"sm:max-w-[900px] max-h-[90vh] overflow-y-auto",children:[e.jsx(Y,{children:e.jsx(G,{children:"Create Quiz"})}),e.jsx(le,{...r,children:e.jsxs("form",{onSubmit:n(T),children:[e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"title",children:"Title"}),e.jsx(D,{name:"title",control:c,render:({field:l})=>e.jsx(F,{...l,id:"title"})}),h.title&&e.jsx("p",{className:"text-sm text-red-500",children:h.title.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"passingMark",children:"Passing Mark"}),e.jsx(D,{name:"passingMark",control:c,render:({field:l})=>e.jsx(F,{...l,id:"passingMark",type:"number"})}),h.passingMark&&e.jsx("p",{className:"text-sm text-red-500",children:h.passingMark.message})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"description",children:"Description"}),e.jsx(de,{control:c,name:"description",label:"",placeholder:"Enter quiz description"}),h.description&&e.jsx("p",{className:"text-sm text-red-500",children:h.description.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{htmlFor:"hasTimeLimit",children:"Has Time Limit"}),e.jsx(D,{name:"hasTimeLimit",control:c,render:({field:l})=>e.jsx(M,{checked:l.value,onCheckedChange:l.onChange})})]}),v&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"timeLimit",children:"Time Limit (minutes)"}),e.jsx(D,{name:"timeLimit",control:c,render:({field:l})=>e.jsx(F,{...l,id:"timeLimit",type:"number"})}),h.timeLimit&&e.jsx("p",{className:"text-sm text-red-500",children:h.timeLimit.message})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{htmlFor:"hasAttemptLimit",children:"Has Attempt Limit"}),e.jsx(D,{name:"hasAttemptLimit",control:c,render:({field:l})=>e.jsx(M,{checked:l.value,onCheckedChange:l.onChange})})]}),g&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"attemptLimit",children:"Attempt Limit"}),e.jsx(D,{name:"attemptLimit",control:c,render:({field:l})=>e.jsx(F,{...l,id:"attemptLimit",type:"number"})}),h.attemptLimit&&e.jsx("p",{className:"text-sm text-red-500",children:h.attemptLimit.message})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{htmlFor:"isActive",children:"Is Active"}),e.jsx(D,{name:"isActive",control:c,render:({field:l})=>e.jsx(M,{checked:l.value,onCheckedChange:l.onChange})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{htmlFor:"isRandomized",children:"Is Randomized"}),e.jsx(D,{name:"isRandomized",control:c,render:({field:l})=>e.jsx(M,{checked:l.value,onCheckedChange:l.onChange})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"quizType",children:"Quiz Type"}),e.jsx(D,{name:"quizType",control:c,render:({field:l})=>e.jsxs(Qe,{onValueChange:l.onChange,defaultValue:l.value,children:[e.jsx($e,{children:e.jsx(Me,{placeholder:"Select quiz type"})}),e.jsxs(Ve,{children:[e.jsx(J,{value:"PRACTICE",children:"Practice"}),e.jsx(J,{value:"FINAL",children:"Final"})]})]})})]})]}),e.jsxs(gs,{className:"mt-6",children:[e.jsx(ys,{asChild:!0,children:e.jsx(m,{type:"button",variant:"secondary",children:"Cancel"})}),e.jsx(m,{type:"submit",children:"Create Quiz"})]})]})})]})})}const $s=ce({title:V().min(1,"Title is required"),summary:V().min(1,"Summary is required"),timeEstimation:ye().min(1,"Time estimation must be at least 1 minute").max(1440,"Time estimation must not exceed 1440 minutes (24 hours)"),lectureType:Ee(["Lesson","Quiz","Practice"]),point:ye().min(0,"Points must be non-negative"),isFree:$()});function Be({lecture:t,onSave:s,onCancel:a}){const r=ae({resolver:oe($s),defaultValues:t||{title:"",summary:"",timeEstimation:30,lectureType:"Lesson",point:0,isFree:!1}}),c=r.handleSubmit(n=>{s(n)});return e.jsx(le,{...r,children:e.jsx(Ae,{...r,children:e.jsxs("form",{onSubmit:c,className:"space-y-8",children:[e.jsxs("div",{className:"pr-4",children:[e.jsx(S,{control:r.control,name:"title",render:({field:n})=>e.jsxs(I,{children:[e.jsx(P,{children:"Title"}),e.jsx(R,{children:e.jsx(F,{...n})}),e.jsx(Z,{})]})}),e.jsx(de,{control:r.control,name:"summary",label:"Summary",placeholder:"Enter lecture summary..."}),e.jsx(S,{control:r.control,name:"timeEstimation",render:({field:n})=>e.jsxs(I,{children:[e.jsx(P,{children:"Time Estimation (minutes)"}),e.jsx(R,{children:e.jsx(F,{type:"number",...n,onChange:j=>n.onChange(parseInt(j.target.value))})}),e.jsx(Z,{})]})}),e.jsx(S,{control:r.control,name:"lectureType",render:({field:n})=>e.jsxs(I,{children:[e.jsx(P,{children:"Lecture Type"}),e.jsxs(Qe,{onValueChange:n.onChange,defaultValue:n.value,children:[e.jsx(R,{children:e.jsx($e,{children:e.jsx(Me,{placeholder:"Select a lecture type"})})}),e.jsxs(Ve,{children:[e.jsx(J,{value:"Lesson",children:"Lesson"}),e.jsx(J,{value:"Quiz",children:"Quiz"}),e.jsx(J,{value:"Practice",children:"Practice"})]})]}),e.jsx(Z,{})]})}),e.jsx(S,{control:r.control,name:"point",render:({field:n})=>e.jsxs(I,{children:[e.jsx(P,{children:"Point"}),e.jsx(R,{children:e.jsx(F,{type:"number",...n,onChange:j=>n.onChange(parseInt(j.target.value))})}),e.jsx(Z,{})]})}),e.jsx(S,{control:r.control,name:"isFree",render:({field:n})=>e.jsxs(I,{className:"flex flex-row items-center justify-between p-4 border rounded-lg",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx(P,{className:"text-base",children:"Free"})}),e.jsx(R,{children:e.jsx(M,{checked:n.value,onCheckedChange:n.onChange})})]})})]}),e.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:a,children:"Cancel"}),e.jsx(m,{type:"submit",children:"Save Lecture"})]})]})})})}function _e({isOpen:t,onClose:s,lecture:a,onSave:r}){return te(),!t||!a?null:e.jsx(q,{open:t,onOpenChange:s,children:e.jsxs(W,{className:"w-[95vw] max-w-[1000px] max-h-[90vh] overflow-y-auto",children:[e.jsx(Y,{children:e.jsx(G,{children:"Edit Lecture"})}),e.jsx(Be,{lecture:a,onSave:r,onCancel:s})]})})}function Ms({chapterId:t,lecture:s,onUpdateLecture:a,onDeleteLecture:r,setIsUpdateLecture:c,isUpdateLecture:n,courseId:j}){const[h,v]=u.useState(!1),[g,C]=u.useState(!1),T=is(),[l,x]=u.useState(!1),[w,y]=u.useState(null),[A,ie]=u.useState(null),B=u.useRef(null),_=u.useRef(null),[H,U]=u.useState(!1),[k,re]=u.useState(null),[o,f]=u.useState(!1),{toast:d}=te();ae({defaultValues:{title:"",description:"",passingMark:0,hasTimeLimit:!1,attemptLimit:0,hasAttemptLimit:!1,isActive:!0,isRandomized:!1,quizType:"PRACTICE"}});const N=()=>{f(!0)};u.useEffect(()=>{(async()=>{try{const p=await Ps(s.id);re(p.lectureDetailsDto.quiz),y(p.lectureDetailsDto.files),ie(p.lectureDetailsDto.problem)}catch{}})()},[s.id,l]),u.useEffect(()=>{const i=()=>{document.body.style.overflow="auto",document.body.style.height="auto"};return H||i(),()=>{i()}},[H]);const me=async(i,p,O)=>{try{v(!0);const L=new FormData;L.append("file",p),L.append("fileType",O);const ts=await Ce(L,i);d({title:"File uploaded",description:"The file has been successfully uploaded.",duration:1500}),x(!l)}catch{d({title:"Upload failed",description:"There was an error uploading the file.",duration:1500})}finally{v(!1)}},ue=async i=>{const p=i.target.files[0];if(p)try{C(!0);const O=await rs(p),L=new FormData;L.append("file",p),L.append("fileType","VIDEO"),L.append("duration",O);const ts=await Ce(L,s.id);d({title:"Video uploaded",description:"The video has been successfully uploaded.",duration:1500}),x(!l),i.target.value=null}catch{d({title:"Upload failed",description:"There was an error uploading the video.",duration:1500})}finally{C(!1)}},He=i=>{console.log(i.id),console.log(j),console.log(s.id),T({to:ns,params:{courseId:j,lectureId:s.id,problemId:i.id}})},Ze=async i=>{try{const p=await Ns(i);x(!l),d({title:"Problem deleted",description:"The problem has been successfully deleted.",duration:1500})}catch{d({title:"Delete failed",description:"There was an error deleting the problem.",duration:1500})}},he=()=>{B.current.click()},pe=()=>{_.current.click()},Je=()=>{T({to:ls,params:{courseId:j,lectureId:s.id}})},We=()=>{U(!0)},Ye=()=>{U(!1)},xe=async i=>{try{const p=await we(i,s.id);x(!l),d({title:"File deleted",description:"The file has been successfully deleted.",duration:1500})}catch{d({title:"Delete failed",description:"There was an error deleting the file.",duration:1500})}},je=async i=>{try{const p=await we(i,s.id);x(!l),d({title:"File deleted",description:"The file has been successfully deleted.",duration:1500})}catch{d({title:"Delete failed",description:"There was an error deleting the file.",duration:1500})}},Ge=async i=>{const p={createQuizDto:{...i}};try{const O=await Cs(p,s.id);d({title:"Quiz created successfully",description:"Quiz created successfully",duration:1500}),x(!l),U(!1)}catch{d({title:"Quiz creation failed",description:"There was an error creating the quiz.",duration:1500})}Ye()},Ke=i=>{T({to:cs,params:{quizId:i}})},Xe=async i=>{try{const p=await ws(i);x(!l),d({title:"Quiz deleted",description:"The quiz has been successfully deleted.",duration:1500})}catch{d({title:"Delete failed",description:"There was an error deleting the quiz.",duration:1500})}},es=async()=>{await r(t,s.id)},ss=async i=>{await a(t,s.id,i),f(!1)};return e.jsxs("div",{className:"flex flex-col p-4 mt-4 rounded-md shadow-sm bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-lg font-medium",children:s.title}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(m,{variant:"ghost",size:"sm",onClick:N,children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Edit lecture"})]}),e.jsxs(Fe,{children:[e.jsx(ze,{asChild:!0,children:e.jsxs(m,{variant:"ghost",size:"sm",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Delete lecture"})]})}),e.jsxs(ke,{children:[e.jsxs(Se,{children:[e.jsx(Ie,{children:"Are you sure you want to delete this lecture?"}),e.jsx(Pe,{children:"This action cannot be undone. This will permanently delete the lecture."})]}),e.jsxs(Re,{children:[e.jsx(Ue,{children:"Cancel"}),e.jsx(Oe,{onClick:es,children:"Delete"})]})]})]}),e.jsx("span",{className:"px-2 py-1 text-sm bg-gray-200 rounded",children:s.lectureType}),e.jsxs("span",{className:"px-2 py-1 text-sm bg-gray-200 rounded",children:[s.point," points"]}),e.jsx("span",{className:`text-sm px-2 py-1 rounded ${s.isFree?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:s.isFree?"Free":"Paid"})]})]}),e.jsx(_e,{isOpen:o,onClose:()=>f(!1),lecture:s,onSave:ss,chapterId:t}),s.lectureType==="Lesson"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{type:"file",ref:B,className:"hidden",onChange:i=>me(s.id,i.target.files[0],"DOCUMENT"),accept:".pdf,.doc,.docx,.txt",multiple:!0}),e.jsx(m,{onClick:he,size:"sm",className:"w-full sm:w-auto",children:h?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 mr-2"})," Upload Files"]})}),w&&w.map((i,p)=>i.fileType==="DOCUMENT"&&e.jsxs("div",{className:"flex items-center p-2 mt-2 bg-white rounded-md",children:[e.jsx(X,{className:"w-4 h-4 mr-2 text-blue-500"}),e.jsx("span",{className:"flex-grow text-sm truncate",children:i.fileName}),e.jsxs(m,{onClick:()=>je(i.fileId),size:"sm",variant:"ghost",className:"ml-2",children:[e.jsx(Q,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"sr-only",children:"Remove file"})]})]},i.fileId))]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",ref:_,className:"hidden",onChange:ue,accept:"video/*",multiple:!0}),e.jsx(m,{onClick:pe,size:"sm",className:"w-full sm:w-auto",disabled:w&&w.some(i=>i.fileType==="VIDEO"),children:g?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[" ",e.jsx(ee,{className:"w-4 h-4 mr-2"})," Upload Video"]})}),w&&w.map((i,p)=>i.fileType==="VIDEO"&&e.jsxs("div",{className:"flex items-center p-2 mt-2 bg-white rounded-md",children:[e.jsx(ee,{className:"w-4 h-4 mr-2 text-blue-500"}),e.jsx("span",{className:"flex-grow text-sm truncate",children:i.fileName}),e.jsxs(m,{onClick:()=>xe(i.fileId),size:"sm",variant:"ghost",className:"ml-2",children:[e.jsx(Q,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"sr-only",children:"Remove video"})]})]},p))]})]}),s.lectureType==="Practice"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{type:"file",ref:B,className:"hidden",onChange:i=>me(s.id,i.target.files[0],"DOCUMENT"),accept:".pdf,.doc,.docx,.txt",multiple:!0}),e.jsx(m,{onClick:he,size:"sm",className:"w-full sm:w-auto",children:h?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 mr-2"})," Upload Files"]})}),w&&w.map((i,p)=>i.fileType==="DOCUMENT"&&e.jsxs("div",{className:"flex items-center p-2 mt-2 bg-white rounded-md",children:[e.jsx(X,{className:"w-4 h-4 mr-2 text-blue-500"}),e.jsx("span",{className:"flex-grow text-sm truncate",children:i.fileName}),e.jsxs(m,{onClick:()=>je(i.fileId),size:"sm",variant:"ghost",className:"ml-2",children:[e.jsx(Q,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"sr-only",children:"Remove file"})]})]},i.fileName))]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",ref:_,className:"hidden",onChange:ue,accept:"video/*",multiple:!0}),e.jsx(m,{onClick:pe,size:"sm",className:"w-full sm:w-auto",disabled:w&&w.some(i=>i.fileType==="VIDEO"),children:g?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[" ",e.jsx(ee,{className:"w-4 h-4 mr-2"})," Upload Video"]})}),w&&w.map((i,p)=>i.fileType==="VIDEO"&&e.jsxs("div",{className:"flex items-center p-2 mt-2 bg-white rounded-md",children:[e.jsx(ee,{className:"w-4 h-4 mr-2 text-blue-500"}),e.jsx("span",{className:"flex-grow text-sm truncate",children:i.fileName}),e.jsxs(m,{onClick:()=>xe(i.fileId),size:"sm",variant:"ghost",className:"ml-2",children:[e.jsx(Q,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"sr-only",children:"Remove video"})]})]}))]}),e.jsxs(m,{onClick:Je,size:"sm",className:"w-full sm:w-auto",disabled:A,children:[e.jsx(ge,{className:"w-4 h-4 mr-2"})," Create Code Problem"]}),A&&e.jsxs("div",{className:"flex items-center p-2 mt-2 bg-white rounded-md",children:[e.jsx(ge,{className:"w-4 h-4 mr-2 text-blue-500"}),e.jsx("span",{className:"flex-grow text-sm truncate",children:A.title}),e.jsxs(m,{onClick:()=>He(A),size:"sm",variant:"ghost",className:"ml-2",children:[e.jsx(Fs,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"sr-only",children:"Edit problem"})]}),e.jsxs(m,{onClick:()=>Ze(A.id),size:"sm",variant:"ghost",className:"ml-2",children:[e.jsx(ve,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"sr-only",children:"Delete problem"})]})]},A.id)]}),s.lectureType==="Quiz"&&e.jsxs("div",{className:"mt-2",children:[e.jsxs(m,{onClick:We,size:"sm",className:"w-full sm:w-auto",children:[e.jsx(fs,{className:"w-4 h-4 mr-2"})," Create Quiz"]}),k&&e.jsxs("div",{className:"flex items-center p-2 mt-2 bg-white rounded-md",children:[e.jsx(bs,{className:"w-4 h-4 mr-2 text-blue-500"}),e.jsx("span",{className:"flex-grow text-sm truncate",children:k.title}),e.jsx(m,{onClick:()=>Ke(k.id),size:"sm",variant:"outline",className:"ml-2",children:e.jsx(Ts,{className:"w-4 h-4 mr-2"})}),e.jsx(m,{onClick:()=>Xe(k.id),size:"sm",variant:"destructive",className:"ml-2",children:e.jsx(ve,{className:"w-4 h-4 mr-2"})})]},k.id)]}),e.jsx(Qs,{isOpen:H,onOpenChange:U,onSubmit:Ge})]})}function Vs({chapterId:t,lectures:s,chapterIndex:a,onAddLecture:r,onUpdateLecture:c,onDeleteLecture:n,courseId:j,setIsUpdate:h,isUpdate:v}){return e.jsxs(e.Fragment,{children:[e.jsx(q,{children:e.jsx(De,{asChild:!0,children:e.jsxs(m,{className:"mt-2",onClick:r,children:[e.jsx(Le,{className:"mr-2"})," Add Lecture"]})})}),s.map((g,C)=>e.jsx(Ms,{chapterId:t,lecture:g,onUpdateLecture:c,onDeleteLecture:n,courseId:j,setIsUpdateLecture:h,isUpdateLecture:v},C))]})}function qs({curriculum:t,courseId:s,onEditChapter:a,onDeleteChapter:r,onAddLecture:c,onUpdateLecture:n,onDeleteLecture:j,setIsUpdate:h,isUpdate:v}){return t.map((g,C)=>e.jsx(Ne,{className:"w-full p-6 mb-6",children:e.jsxs("div",{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(ks,{chapter:g.chapterDto,onEdit:()=>a(g.chapterDto.id),onDelete:()=>r(g.chapterDto.id)}),e.jsx(Vs,{chapterId:g.chapterDto.id,lectures:g.lectureDtos,chapterIndex:C,onAddLecture:()=>c(g.chapterDto.id),onUpdateLecture:n,onDeleteLecture:j,courseId:s,setIsUpdate:h,isUpdate:v})]})},C))}function Bs({isOpen:t,onClose:s,onSave:a}){return e.jsx(q,{open:t,onOpenChange:s,children:e.jsxs(W,{className:"w-[95vw] max-w-[1000px] max-h-[90vh] overflow-y-auto",children:[e.jsx(Y,{children:e.jsx(G,{children:"Add New Lecture"})}),e.jsx(Be,{onSave:a,onCancel:s})]})})}function _s({isOpen:t,onClose:s,chapter:a,onSave:r}){return!t||!a?null:e.jsx(q,{open:t,onOpenChange:s,children:e.jsxs(W,{className:"w-[95vw] max-w-[1000px] max-h-[90vh] overflow-y-auto",children:[e.jsx(Y,{children:e.jsx(G,{children:"Edit Chapter"})}),e.jsx(qe,{chapter:a,onSave:c=>{r(c),s()},onCancel:s})]})})}const Hs=async(t,s)=>{try{return(await z.post(`/learning-service/courses/${s}/chapters`,t,{headers:{Authorization:`Bearer ${E.get("authToken")}`}})).data}catch(a){throw console.error("Error creating course:",a),a}},Zs=async(t,s,a)=>{try{return(await z.put(`/learning-service/courses/${s}/chapters/${a}`,t,{headers:{Authorization:`Bearer ${E.get("authToken")}`}})).data}catch(r){throw console.error("Error updating chapter:",r),r}},Js=async(t,s)=>{try{return(await z.delete(`/learning-service/courses/${t}/chapters/${s}`,{headers:{Authorization:`Bearer ${E.get("authToken")}`}})).data}catch(a){throw console.error("Error deleting chapter:",a),a}},Ws=({chapter:t,handleUpdateChapter:s,courseId:a})=>{const[r,c]=u.useState(!1),[n,j]=u.useState(!1),[h,v]=u.useState(null);u.useState(null);const[g,C]=u.useState(!1),[T,l]=u.useState(null),[x,w]=u.useState(null),{toast:y}=te();u.useEffect(()=>{const o=()=>{document.body.style.overflow="auto",document.body.style.height="auto"};return!n&&h===null&&!g&&x===null&&o(),()=>{o()}},[n,h,g,x,r]);const A=o=>{const f=t.find(d=>d.chapterDto&&d.chapterDto.id===o);f?v(f.chapterDto):y({title:"Error",description:"Could not find chapter to edit",variant:"destructive"})},ie=async o=>{try{const f={chapter:{title:o.title,description:o.description,isActive:o.isActive}};await Zs(f,a,o.id),s(),v(null),y({title:"Chapter updated successfully",description:"The chapter has been updated."})}catch{y({title:"Error",description:"Failed to update the chapter. Please try again.",variant:"destructive"})}},B=u.useCallback(async(o,f,d)=>{try{await Rs(o,f,d),s(),y({title:"Lecture updated successfully",description:"The lecture has been updated."})}catch{y({title:"Error",description:"Failed to update the lecture. Please try again.",variant:"destructive"})}},[s,y]),_=u.useCallback(async(o,f)=>{try{await Us(o,f),s(),y({title:"Lecture deleted successfully",description:"The lecture has been removed."})}catch{y({title:"Error",description:"Failed to delete the lecture. Please try again.",variant:"destructive"})}},[s,y]),H=async(o,f)=>{const d={createChapterDto:{...o}};try{const N=await Hs(d,f);y({title:"Chapter created successfully",description:"Chapter created successfully"}),j(!1),s()}catch{}},U=async o=>{try{await Js(a,o),s(),y({title:"Chapter deleted successfully",description:"The chapter has been removed."})}catch{y({title:"Error",description:"Failed to delete the chapter. Please try again.",variant:"destructive"})}},k=async(o,f)=>{const d={createLectureDto:{...f}};try{const N=await Is(o,d);y({title:"Lecture created successfully",description:"Lecture created successfully"}),C(!1),s()}catch{}},re=(o,f,d)=>{const N=[...curriculum];N[f].lectures[d]={...N[f].lectures[d],...o},setCurriculum(N),w(null),y({title:"Lecture updated",description:"The lecture has been successfully updated.",duration:1500})};return e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"mb-4 text-2xl font-semibold",children:"Curriculum"}),e.jsxs(q,{open:n,onOpenChange:j,children:[e.jsx(De,{asChild:!0,children:e.jsxs(m,{className:"mb-4",onClick:()=>j(!0),children:[e.jsx(Le,{className:"mr-2"})," Add Chapter"]})}),e.jsxs(W,{className:"w-[95vw] max-w-[1000px] max-h-[90vh] overflow-y-auto",children:[e.jsx(Y,{children:e.jsx(G,{children:"Add New Chapter"})}),e.jsx(qe,{onSave:o=>H(o,a),onCancel:()=>j(!1)})]})]}),e.jsx(qs,{setIsUpdate:c,isUpdate:r,curriculum:t,onEditChapter:A,onDeleteChapter:U,onAddLecture:o=>{l(o),C(!0)},onUpdateLecture:B,onDeleteLecture:_,courseId:a}),e.jsx(Bs,{isOpen:g,onClose:()=>C(!1),onSave:o=>k(T,o)}),h&&e.jsx(_s,{isOpen:h!==null,onClose:()=>v(null),chapter:h,onSave:ie}),e.jsx(_e,{isOpen:x!==null,onClose:()=>w(null),lecture:x==null?void 0:x.lecture,onSave:o=>re(o,x.chapterIndex,x.lectureIndex)})]})},Ys=be.memo(Ws),Gs=()=>{const t=[{label:"CourseTable",href:xs},{label:"Edit Curriculum Course",href:js}],{params:s}=os(ds.id),{courseId:a}=s,{setCourseIdToBack:r}=Ds(),[c,n]=u.useState(null),[j,h]=u.useState(null),[v,g]=u.useState(!1);u.useEffect(()=>{(async()=>{try{const x=await Ls(a);console.log(x),r(a),n(x.courseDetailsDto.courseDto),h(x.courseDetailsDto.chapterDetailsDtos),console.log(x.courseDetailsDto.chapterDetailsDtos)}catch(x){console.error("Failed to fetch course details:",x)}})()},[v]);const C=()=>{g(!v)},T=()=>{console.log("Edit info button clicked"),alert("Edit course info functionality to be implemented")};return c?e.jsx(e.Fragment,{children:e.jsx(As,{breadcrumbs:t,children:e.jsxs("div",{className:"flex flex-col lg:flex-row min-h-screen",children:[e.jsx("div",{className:"w-full lg:w-1/4 p-4 overflow-auto",children:e.jsxs(Ne,{children:[e.jsx(ms,{children:e.jsx("img",{src:c.imageUrl,alt:"Course Image",className:"w-full h-48 object-cover rounded-t-lg"})}),e.jsxs(us,{className:"space-y-4",children:[e.jsx(hs,{className:"text-xl lg:text-2xl",children:c.title}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-2 sm:space-y-0",children:[e.jsxs("span",{className:"text-xl lg:text-2xl font-bold",children:["$",c.price]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(fe,{variant:"secondary",children:c.courseLevel}),e.jsx(fe,{variant:"outline",children:c.courseStatus})]})]}),e.jsx(ps,{}),e.jsx("p",{className:"text-sm lg:text-base text-muted-foreground",children:c.headline}),e.jsx(m,{onClick:T,className:"w-full mt-4",children:"Edit Info"})]})]})}),e.jsx("div",{className:"w-full lg:w-3/4 p-4 overflow-auto",children:e.jsx(Ys,{chapter:j,courseId:a,handleUpdateChapter:C})})]})})}):e.jsx(Es,{})},Lt=be.memo(Gs);export{Lt as default};
//# sourceMappingURL=EditCurriculumCourse-azfiSn-c.js.map
